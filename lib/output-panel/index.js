"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
const etch = require("etch");
const atom_1 = require("atom");
const output_panel_buttons_1 = require("./views/output-panel-buttons");
const output_panel_checkbox_1 = require("./views/output-panel-checkbox");
const progress_bar_1 = require("./views/progress-bar");
const output_panel_items_1 = require("./views/output-panel-items");
const $ = etch.dom;
class OutputPanel {
    constructor(state = {}, results) {
        this.state = state;
        this.results = results;
        this.hiddenOutput = true;
        this.elements = new Set();
        this.statusMap = new Map();
        this.disposables = new atom_1.CompositeDisposable();
        this.currentResult = 0;
        etch.initialize(this);
        atom.config.observe('ide-haskell.panelPosition', (value) => {
            this.pos = value;
            const options = {
                item: this,
                visible: this.state.visibility || true
            };
            switch (this.pos) {
                case 'top':
                    this.panel = atom.workspace.addTopPanel(options);
                    break;
                case 'bottom':
                    this.panel = atom.workspace.addBottomPanel(options);
                    break;
                case 'left':
                    this.panel = atom.workspace.addLeftPanel(options);
                    break;
                case 'right':
                    this.panel = atom.workspace.addRightPanel(options);
                    break;
                default: throw new TypeError('Switch assertion failed');
            }
            if (this.element) {
                this.update();
            }
        });
        this.disposables.add(atom.tooltips.add(this.refs.status, {
            class: 'ide-haskell-status-tooltip',
            title: () => {
                const res = [];
                for (const [plugin, { status, detail }] of this.statusMap.entries()) {
                    res.push(`
          <ide-haskell-status-item>
            <ide-haskell-status-icon data-status="${status}">${plugin}</ide-haskell-status-icon>
            <ide-haskell-status-detail>${detail || ''}</ide-haskell-status-detail>
          </ide-haskell-status-item>
          `);
                }
                return res.join('');
            }
        }));
        this.disposables.add(this.results.onDidUpdate(({ types }) => {
            this.currentResult = 0;
            if (atom.config.get('ide-haskell.autoHideOutput') &&
                types.map((type) => this.results.filter(({ severity }) => severity === type).length).every((l) => l === 0)) {
                this.refs.buttons.disableAll();
            }
            else {
                if (atom.config.get('ide-haskell.switchTabOnCheck')) {
                    this.activateFirstNonEmptyTab(types);
                }
            }
            this.updateItems();
        }));
        this.setProgress(NaN);
        this.disposables.add(this.refs.buttons.onButtonClicked(() => this.updateItems()));
        this.disposables.add(this.refs.checkboxUriFilter.onCheckboxSwitched(() => this.updateItems()));
        this.disposables.add(atom.workspace.onDidChangeActivePaneItem(() => {
            if (this.refs.checkboxUriFilter.getFileFilter()) {
                this.updateItems();
            }
        }));
    }
    render() {
        const orientMap = {
            top: 'horizontal',
            bottom: 'horizontal',
            left: 'vertical',
            right: 'vertical'
        };
        return (etch.dom("ide-haskell-panel", { style: { width: this.state.width, height: this.state.height }, dataset: { pos: this.pos }, class: this.hiddenOutput ? 'hidden-output' : '' },
            etch.dom("resize-handle", { on: { mousedown: this.resizeStart.bind(this) } }),
            etch.dom("ide-haskell-panel-heading", { ref: "heading" },
                etch.dom("ide-haskell-status-icon", { ref: "status", id: "status", dataset: { status: 'ready' } }),
                etch.dom(output_panel_buttons_1.OutputPanelButtons, { ref: "buttons", id: "buttons" }),
                etch.dom(output_panel_checkbox_1.OutputPanelCheckbox, { ref: "checkboxUriFilter", id: "checkboxUriFilter", enabled: this.state.fileFilter }),
                Array.from(this.elements.values()),
                etch.dom(progress_bar_1.ProgressBar, { ref: "progressBar", id: "progressBar", orientation: orientMap[this.pos] })),
            etch.dom(output_panel_items_1.OutputPanelItems, { model: this.results, ref: "items", id: "items" })));
    }
    update() {
        return etch.update(this);
    }
    destroy() {
        return __awaiter(this, void 0, void 0, function* () {
            yield etch.destroy(this);
            this.disposables.dispose();
            this.panel.destroy();
            this.statusMap.clear();
        });
    }
    addPanelControl(element, opts) {
        if (typeof element === 'string') {
            const { events, classes, style, attrs } = opts;
            const props = {};
            if (classes) {
                props.class = classes.join(' ');
            }
            if (style) {
                props.style = style;
            }
            if (attrs) {
                props.attributes = attrs;
            }
            if (events) {
                props.on = events;
            }
            element = $(element, props);
        }
        else {
            element = $(element, opts);
        }
        this.elements.add(element);
        this.update();
        return new atom_1.Disposable(() => {
            this.elements.delete(element);
            this.update();
        });
    }
    updateItems() {
        const activeTab = this.getActiveTab();
        let currentUri;
        if (activeTab) {
            this.hiddenOutput = false;
            let filterUri;
            const filterSeverity = activeTab;
            const ato = this.refs.buttons.options(activeTab);
            if (this.refs.checkboxUriFilter.getFileFilter()) {
                currentUri = atom.workspace.getActiveTextEditor().getPath();
                if (currentUri && ato && ato.uriFilter) {
                    filterUri = currentUri;
                }
            }
            const scroll = ato && ato.autoScroll && this.refs.items.atEnd();
            this.refs.items.filter(({ uri, severity }) => (severity === filterSeverity) && (!filterUri || uri === filterUri));
            if (scroll) {
                this.refs.items.scrollToEnd();
            }
        }
        else {
            this.hiddenOutput = true;
        }
        this.refs.buttons.buttonNames().forEach((btn) => {
            const f = { severity: btn };
            const ato = this.refs.buttons.options(btn);
            if (currentUri && ato && ato.uriFilter) {
                f.uri = currentUri;
            }
            this.refs.buttons.setCount(btn, this.results.filter(({ uri, severity }) => (severity === f.severity) && (!f.uri || uri === f.uri)).length);
        });
        this.update();
    }
    activateTab(tab) {
        this.refs.buttons.clickButton(tab);
    }
    activateFirstNonEmptyTab(types) {
        const names = this.refs.buttons.buttonNames();
        for (const i of names) {
            const name = names[i];
            if (!types || types.includes(name)) {
                if ((this.results.filter(({ severity }) => severity === name)).length > 0) {
                    this.activateTab(name);
                    break;
                }
            }
        }
    }
    showItem(item) {
        this.activateTab(item.severity);
        this.refs.items.showItem(item);
    }
    getActiveTab() {
        return this.refs.buttons.getActive();
    }
    createTab(name, opts) {
        if (!this.refs.buttons.buttonNames().includes(name)) {
            this.refs.buttons.createButton(name, opts);
            this.state.activeTab && this.activateTab(this.state.activeTab);
        }
    }
    setProgress(progress) {
        this.refs.progressBar.setProgress(progress);
    }
    toggle() {
        if (this.panel.isVisible()) {
            this.panel.hide();
        }
        else {
            this.panel.show();
        }
    }
    serialize() {
        return {
            visibility: this.panel.isVisible(),
            height: this.element && this.element.style.height || this.state.height,
            width: this.element && this.element.style.width || this.state.width,
            activeTab: this.getActiveTab(),
            fileFilter: this.refs.checkboxUriFilter.getFileFilter()
        };
    }
    backendStatus(pluginName, st) {
        const prio = {
            progress: 5,
            error: 20,
            warning: 10,
            ready: 0
        };
        this.statusMap.set(pluginName, st);
        const stArr = Array.from(this.statusMap.values());
        const [consensus] = stArr.sort((a, b) => prio[b.status] - prio[a.status]);
        this.refs.status.setAttribute('data-status', consensus.status);
        let count = 0;
        let tot = 0;
        for (const i of stArr) {
            if (i.status === 'progress' && i.progress !== undefined) {
                tot += i.progress;
                count++;
            }
        }
        const progressAve = tot / count;
        this.setProgress(progressAve);
    }
    showNextError() {
        const rs = this.results.filter(({ uri }) => !!uri);
        if (rs.length === 0) {
            return;
        }
        if (this.currentResult !== undefined) {
            this.currentResult++;
        }
        else {
            this.currentResult = 0;
        }
        if (this.currentResult >= rs.length) {
            this.currentResult = 0;
        }
        this.showItem(rs[this.currentResult]);
    }
    showPrevError() {
        const rs = this.results.filter(({ uri }) => !!uri);
        if (rs.length === 0) {
            return;
        }
        if (this.currentResult !== undefined) {
            this.currentResult--;
        }
        else {
            this.currentResult = rs.length - 1;
        }
        if (this.currentResult < 0) {
            this.currentResult = rs.length - 1;
        }
        this.showItem(rs[this.currentResult]);
    }
    resizeStart(e) {
        if (!this.element) {
            return;
        }
        const varsMap = {
            top: { axis: 'Y', param: 'height', dir: 1 },
            bottom: { axis: 'Y', param: 'height', dir: -1 },
            left: { axis: 'X', param: 'width', dir: 1 },
            right: { axis: 'X', param: 'width', dir: -1 }
        };
        const vars = varsMap[this.pos];
        vars.axis = `client${vars.axis}`;
        const startAxis = e[vars.axis];
        const startParam = parseInt(document.defaultView.getComputedStyle(this.element)[vars.param], 10);
        const doDrag = (event) => {
            this.state[vars.param] =
                (startParam + vars.dir * (event[vars.axis] - startAxis)) + 'px';
            this.update();
        };
        const stopDrag = () => {
            document.documentElement.removeEventListener('mousemove', doDrag);
            document.documentElement.removeEventListener('mouseup', stopDrag);
        };
        document.documentElement.addEventListener('mousemove', doDrag);
        document.documentElement.addEventListener('mouseup', stopDrag);
    }
}
exports.OutputPanel = OutputPanel;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvb3V0cHV0LXBhbmVsL2luZGV4LnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQUEsNkJBQTRCO0FBQzVCLCtCQUEyRDtBQUMzRCx1RUFBdUY7QUFDdkYseUVBQWlFO0FBQ2pFLHVEQUFnRDtBQUNoRCxtRUFBMkQ7QUFFM0QsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQTtBQW1DbEI7SUFtQkUsWUFBcUIsUUFBNEIsRUFBRSxFQUFVLE9BQWtCO1FBQTFELFVBQUssR0FBTCxLQUFLLENBQXlCO1FBQVUsWUFBTyxHQUFQLE9BQU8sQ0FBVztRQUM3RSxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQTtRQUV4QixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksR0FBRyxFQUFFLENBQUE7UUFFekIsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFBO1FBRTFCLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSwwQkFBbUIsRUFBRSxDQUFBO1FBRTVDLElBQUksQ0FBQyxhQUFhLEdBQUcsQ0FBQyxDQUFBO1FBRXRCLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUE7UUFFckIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsMkJBQTJCLEVBQUUsQ0FBQyxLQUFxQjtZQUNyRSxJQUFJLENBQUMsR0FBRyxHQUFHLEtBQUssQ0FBQTtZQUNoQixNQUFNLE9BQU8sR0FBRztnQkFDZCxJQUFJLEVBQUUsSUFBSTtnQkFDVixPQUFPLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxVQUFVLElBQUksSUFBSTthQUN2QyxDQUFBO1lBQ0QsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQ2pCLEtBQUssS0FBSztvQkFDUixJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxTQUFTLENB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QUMsQ0FBQyxHQUFHLElBQUksQ0FBQTtZQUNqRSxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUE7UUFDZixDQUFDLENBQUE7UUFDRCxNQUFNLFFBQVEsR0FBRztZQUNmLFFBQVEsQ0FBQyxlQUFlLENBQUMsbUJBQW1CLENBQUMsV0FBVyxFQUFFLE1BQU0sQ0FBQyxDQUFBO1lBQ2pFLFFBQVEsQ0FBQyxlQUFlLENBQUMsbUJBQW1CLENBQUMsU0FBUyxFQUFFLFFBQVEsQ0FBQyxDQUFBO1FBQ25FLENBQUMsQ0FBQTtRQUVELFFBQVEsQ0FBQyxlQUFlLENBQUMsZ0JBQWdCLENBQUMsV0FBVyxFQUFFLE1BQU0sQ0FBQyxDQUFBO1FBQzlELFFBQVEsQ0FBQyxlQUFlLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxFQUFFLFFBQVEsQ0FBQyxDQUFBO0lBQ2hFLENBQUM7Q0FDRjtBQWxVRCxrQ0FrVUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBldGNoIGZyb20gJ2V0Y2gnXG5pbXBvcnQge0Rpc3Bvc2FibGUsIENvbXBvc2l0ZURpc3Bvc2FibGUsIFBhbmVsfSBmcm9tICdhdG9tJ1xuaW1wb3J0IHtPdXRwdXRQYW5lbEJ1dHRvbnMsIElTZXZlcml0eVRhYkRlZmluaXRpb259IGZyb20gJy4vdmlld3Mvb3V0cHV0LXBhbmVsLWJ1dHRvbnMnXG5pbXBvcnQge091dHB1dFBhbmVsQ2hlY2tib3h9IGZyb20gJy4vdmlld3Mvb3V0cHV0LXBhbmVsLWNoZWNrYm94J1xuaW1wb3J0IHtQcm9ncmVzc0Jhcn0gZnJvbSAnLi92aWV3cy9wcm9ncmVzcy1iYXInXG5pbXBvcnQge091dHB1dFBhbmVsSXRlbXN9IGZyb20gJy4vdmlld3Mvb3V0cHV0LXBhbmVsLWl0ZW1zJ1xuaW1wb3J0IHtSZXN1bHRzREIsIFJlc3VsdEl0ZW19IGZyb20gJy4uL3Jlc3VsdHMtZGInXG5jb25zdCAkID0gZXRjaC5kb21cblxuZXhwb3J0IHtJU2V2ZXJpdHlUYWJEZWZpbml0aW9ufVxuXG5pbnRlcmZhY2UgSVN0YXRlIHtcbiAgdmlzaWJpbGl0eT86IGJvb2xlYW5cbiAgd2lkdGg/OiBudW1iZXJcbiAgaGVpZ2h0PzogbnVtYmVyXG4gIGZpbGVGaWx0ZXI/OiBib29sZWFuXG4gIGFjdGl2ZVRhYj86IHN0cmluZ1xufVxuXG5pbnRlcmZhY2UgSU5vcm1hbFN0YXR1cyB7XG4gIHN0YXR1czogJ3JlYWR5JyB8ICdlcnJvcicgfCAnd2FybmluZydcbn1cblxuaW50ZXJmYWNlIElQcm9ncmVzc1N0YXR1cyB7XG4gIHN0YXR1czogJ3Byb2dyZXNzJ1xuICBwcm9ncmVzcz86IG51bWJlclxufVxuXG5leHBvcnQgdHlwZSBJU3RhdHVzID0gKElOb3JtYWxTdGF0dXMgfCBJUHJvZ3Jlc3NTdGF0dXMpICYge2RldGFpbDogc3RyaW5nfVxuXG5leHBvcnQgdHlwZSBUUGFuZWxQb3NpdGlvbiA9ICdib3R0b20nIHwgJ2xlZnQnIHwgJ3RvcCcgfCAncmlnaHQnXG5cbmV4cG9ydCBpbnRlcmZhY2UgSVNldFR5cGVzUGFyYW1zIHtbc2V2ZXJpdHk6IHN0cmluZ106IElTZXZlcml0eVRhYkRlZmluaXRpb259XG5cbmV4cG9ydCBpbnRlcmZhY2UgSUNvbnRyb2xPcHRzIHtcbiAgaWQ/OiBzdHJpbmdcbiAgZXZlbnRzPzoge1trZXk6IHN0cmluZ106IEV2ZW50TGlzdGVuZXJ9XG4gIGNsYXNzZXM/OiBzdHJpbmdbXVxuICBzdHlsZT86IHtba2V5OiBzdHJpbmddOiBzdHJpbmd9XG4gIGF0dHJzPzoge1trZXk6IHN0cmluZ106IHN0cmluZ31cbn1cblxuZXhwb3J0IGNsYXNzIE91dHB1dFBhbmVsIHtcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLXVuaW5pdGlhbGl6ZWQtY2xhc3MtcHJvcGVydGllc1xuICBwcml2YXRlIHJlZnM6IHtcbiAgICBpdGVtczogT3V0cHV0UGFuZWxJdGVtc1xuICAgIGJ1dHRvbnM6IE91dHB1dFBhbmVsQnV0dG9uc1xuICAgIHN0YXR1czogSFRNTEVsZW1lbnRcbiAgICBjaGVja2JveFVyaUZpbHRlcjogT3V0cHV0UGFuZWxDaGVja2JveFxuICAgIHByb2dyZXNzQmFyOiBQcm9ncmVzc0JhclxuICB9XG4gIHByaXZhdGUgaGlkZGVuT3V0cHV0OiBib29sZWFuXG4gIHByaXZhdGUgZWxlbWVudHM6IFNldDxKU1guRWxlbWVudD5cbiAgcHJpdmF0ZSBzdGF0dXNNYXA6IE1hcDxzdHJpbmcsIElTdGF0dXM+XG4gIHByaXZhdGUgZGlzcG9zYWJsZXM6IENvbXBvc2l0ZURpc3Bvc2FibGVcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLXVuaW5pdGlhbGl6ZWQtY2xhc3MtcHJvcGVydGllc1xuICBwcml2YXRlIHBvczogVFBhbmVsUG9zaXRpb25cbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLXVuaW5pdGlhbGl6ZWQtY2xhc3MtcHJvcGVydGllc1xuICBwcml2YXRlIHBhbmVsOiBQYW5lbFxuICBwcml2YXRlIGVsZW1lbnQ/OiBIVE1MRWxlbWVudFxuICBwcml2YXRlIGN1cnJlbnRSZXN1bHQ6IG51bWJlclxuICBjb25zdHJ1Y3RvciAocHJpdmF0ZSBzdGF0ZTogSVN0YXRlIHwgdW5kZWZpbmVkID0ge30sIHByaXZhdGUgcmVzdWx0czogUmVzdWx0c0RCKSB7XG4gICAgdGhpcy5oaWRkZW5PdXRwdXQgPSB0cnVlXG5cbiAgICB0aGlzLmVsZW1lbnRzID0gbmV3IFNldCgpXG5cbiAgICB0aGlzLnN0YXR1c01hcCA9IG5ldyBNYXAoKVxuXG4gICAgdGhpcy5kaXNwb3NhYmxlcyA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKClcblxuICAgIHRoaXMuY3VycmVudFJlc3VsdCA9IDBcblxuICAgIGV0Y2guaW5pdGlhbGl6ZSh0aGlzKVxuXG4gICAgYXRvbS5jb25maWcub2JzZXJ2ZSgnaWRlLWhhc2tlbGwucGFuZWxQb3NpdGlvbicsICh2YWx1ZTogVFBhbmVsUG9zaXRpb24pID0+IHtcbiAgICAgIHRoaXMucG9zID0gdmFsdWVcbiAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgIGl0ZW06IHRoaXMsXG4gICAgICAgIHZpc2libGU6IHRoaXMuc3RhdGUudmlzaWJpbGl0eSB8fCB0cnVlXG4gICAgICB9XG4gICAgICBzd2l0Y2ggKHRoaXMucG9zKSB7XG4gICAgICAgIGNhc2UgJ3RvcCc6XG4gICAgICAgICAgdGhpcy5wYW5lbCA9IGF0b20ud29ya3NwYWNlLmFkZFRvcFBhbmVsKG9wdGlvbnMpXG4gICAgICAgICAgYnJlYWtcbiAgICAgICAgY2FzZSAnYm90dG9tJzpcbiAgICAgICAgICB0aGlzLnBhbmVsID0gYXRvbS53b3Jrc3BhY2UuYWRkQm90dG9tUGFuZWwob3B0aW9ucylcbiAgICAgICAgICBicmVha1xuICAgICAgICBjYXNlICdsZWZ0JzpcbiAgICAgICAgICB0aGlzLnBhbmVsID0gYXRvbS53b3Jrc3BhY2UuYWRkTGVmdFBhbmVsKG9wdGlvbnMpXG4gICAgICAgICAgYnJlYWtcbiAgICAgICAgY2FzZSAncmlnaHQnOlxuICAgICAgICAgIHRoaXMucGFuZWwgPSBhdG9tLndvcmtzcGFjZS5hZGRSaWdodFBhbmVsKG9wdGlvbnMpXG4gICAgICAgICAgYnJlYWtcbiAgICAgICAgZGVmYXVsdDogdGhyb3cgbmV3IFR5cGVFcnJvcignU3dpdGNoIGFzc2VydGlvbiBmYWlsZWQnKVxuICAgICAgfVxuICAgICAgaWYgKHRoaXMuZWxlbWVudCkge1xuICAgICAgICB0aGlzLnVwZGF0ZSgpXG4gICAgICB9XG4gICAgfSlcblxuICAgIHRoaXMuZGlzcG9zYWJsZXMuYWRkKGF0b20udG9vbHRpcHMuYWRkKHRoaXMucmVmcy5zdGF0dXMsIHtcbiAgICAgIGNsYXNzOiAnaWRlLWhhc2tlbGwtc3RhdHVzLXRvb2x0aXAnLFxuICAgICAgdGl0bGU6ICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzID0gW11cbiAgICAgICAgZm9yIChjb25zdCBbcGx1Z2luLCB7c3RhdHVzLCBkZXRhaWx9XSBvZiB0aGlzLnN0YXR1c01hcC5lbnRyaWVzKCkpIHtcbiAgICAgICAgICByZXMucHVzaChgXG4gICAgICAgICAgPGlkZS1oYXNrZWxsLXN0YXR1cy1pdGVtPlxuICAgICAgICAgICAgPGlkZS1oYXNrZWxsLXN0YXR1cy1pY29uIGRhdGEtc3RhdHVzPVwiJHtzdGF0dXN9XCI+JHtwbHVnaW59PC9pZGUtaGFza2VsbC1zdGF0dXMtaWNvbj5cbiAgICAgICAgICAgIDxpZGUtaGFza2VsbC1zdGF0dXMtZGV0YWlsPiR7ZGV0YWlsIHx8ICcnfTwvaWRlLWhhc2tlbGwtc3RhdHVzLWRldGFpbD5cbiAgICAgICAgICA8L2lkZS1oYXNrZWxsLXN0YXR1cy1pdGVtPlxuICAgICAgICAgIGApXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlcy5qb2luKCcnKVxuICAgICAgfVxuICAgIH0pKVxuXG4gICAgdGhpcy5kaXNwb3NhYmxlcy5hZGQodGhpcy5yZXN1bHRzLm9uRGlkVXBkYXRlKCh7dHlwZXN9KSA9PiB7XG4gICAgICB0aGlzLmN1cnJlbnRSZXN1bHQgPSAwXG4gICAgICBpZiAoYXRvbS5jb25maWcuZ2V0KCdpZGUtaGFza2VsbC5hdXRvSGlkZU91dHB1dCcpICYmXG4gICAgICAgICAgdHlwZXMubWFwKCh0eXBlKSA9PiB0aGlzLnJlc3VsdHMuZmlsdGVyKCh7c2V2ZXJpdHl9KSA9PiBzZXZlcml0eSA9PT0gdHlwZSkubGVuZ3RoKS5ldmVyeSgobCkgPT4gbCA9PT0gMCkpIHtcbiAgICAgICAgdGhpcy5yZWZzLmJ1dHRvbnMuZGlzYWJsZUFsbCgpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoYXRvbS5jb25maWcuZ2V0KCdpZGUtaGFza2VsbC5zd2l0Y2hUYWJPbkNoZWNrJykpIHtcbiAgICAgICAgICB0aGlzLmFjdGl2YXRlRmlyc3ROb25FbXB0eVRhYih0eXBlcylcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhpcy51cGRhdGVJdGVtcygpXG4gICAgfSkpXG5cbiAgICB0aGlzLnNldFByb2dyZXNzKE5hTilcblxuICAgIHRoaXMuZGlzcG9zYWJsZXMuYWRkKHRoaXMucmVmcy5idXR0b25zLm9uQnV0dG9uQ2xpY2tlZCgoKSA9PiB0aGlzLnVwZGF0ZUl0ZW1zKCkpKVxuICAgIHRoaXMuZGlzcG9zYWJsZXMuYWRkKHRoaXMucmVmcy5jaGVja2JveFVyaUZpbHRlci5vbkNoZWNrYm94U3dpdGNoZWQoKCkgPT4gdGhpcy51cGRhdGVJdGVtcygpKSlcbiAgICB0aGlzLmRpc3Bvc2FibGVzLmFkZChhdG9tLndvcmtzcGFjZS5vbkRpZENoYW5nZUFjdGl2ZVBhbmVJdGVtKCgpID0+IHtcbiAgICAgIGlmICh0aGlzLnJlZnMuY2hlY2tib3hVcmlGaWx0ZXIuZ2V0RmlsZUZpbHRlcigpKSB7IHRoaXMudXBkYXRlSXRlbXMoKSB9XG4gICAgfSkpXG4gIH1cblxuICBwdWJsaWMgcmVuZGVyICgpIHtcbiAgICBjb25zdCBvcmllbnRNYXAgPSB7XG4gICAgICB0b3A6ICdob3Jpem9udGFsJyxcbiAgICAgIGJvdHRvbTogJ2hvcml6b250YWwnLFxuICAgICAgbGVmdDogJ3ZlcnRpY2FsJyxcbiAgICAgIHJpZ2h0OiAndmVydGljYWwnXG4gICAgfVxuICAgIHJldHVybiAoXG4gICAgICA8aWRlLWhhc2tlbGwtcGFuZWwgc3R5bGU9e3t3aWR0aDogdGhpcy5zdGF0ZS53aWR0aCwgaGVpZ2h0OiB0aGlzLnN0YXRlLmhlaWdodH19XG4gICAgICAgIGRhdGFzZXQ9e3twb3M6IHRoaXMucG9zfX1cbiAgICAgICAgY2xhc3M9e3RoaXMuaGlkZGVuT3V0cHV0ID8gJ2hpZGRlbi1vdXRwdXQnIDogJyd9PlxuICAgICAgICA8cmVzaXplLWhhbmRsZSBvbj17e21vdXNlZG93bjogdGhpcy5yZXNpemVTdGFydC5iaW5kKHRoaXMpfX0gLz5cbiAgICAgICAgPGlkZS1oYXNrZWxsLXBhbmVsLWhlYWRpbmcgcmVmPVwiaGVhZGluZ1wiPlxuICAgICAgICAgIDxpZGUtaGFza2VsbC1zdGF0dXMtaWNvbiByZWY9XCJzdGF0dXNcIiBpZD1cInN0YXR1c1wiIGRhdGFzZXQ9e3tzdGF0dXM6ICdyZWFkeSd9fS8+XG4gICAgICAgICAgPE91dHB1dFBhbmVsQnV0dG9ucyByZWY9XCJidXR0b25zXCIgaWQ9XCJidXR0b25zXCIvPlxuICAgICAgICAgIDxPdXRwdXRQYW5lbENoZWNrYm94IHJlZj1cImNoZWNrYm94VXJpRmlsdGVyXCIgaWQ9XCJjaGVja2JveFVyaUZpbHRlclwiXG4gICAgICAgICAgICBlbmFibGVkPXt0aGlzLnN0YXRlLmZpbGVGaWx0ZXJ9Lz5cbiAgICAgICAgICB7QXJyYXkuZnJvbSh0aGlzLmVsZW1lbnRzLnZhbHVlcygpKX1cbiAgICAgICAgICA8UHJvZ3Jlc3NCYXIgcmVmPVwicHJvZ3Jlc3NCYXJcIiBpZD1cInByb2dyZXNzQmFyXCJcbiAgICAgICAgICAgIG9yaWVudGF0aW9uPXtvcmllbnRNYXBbdGhpcy5wb3NdfS8+XG4gICAgICAgIDwvaWRlLWhhc2tlbGwtcGFuZWwtaGVhZGluZz5cbiAgICAgICAgPE91dHB1dFBhbmVsSXRlbXMgbW9kZWw9e3RoaXMucmVzdWx0c30gcmVmPVwiaXRlbXNcIiBpZD1cIml0ZW1zXCIvPlxuICAgICAgPC9pZGUtaGFza2VsbC1wYW5lbD5cbiAgICApXG4gIH1cblxuICBwdWJsaWMgdXBkYXRlICgpIHtcbiAgICByZXR1cm4gZXRjaC51cGRhdGUodGhpcylcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBkZXN0cm95ICgpIHtcbiAgICBhd2FpdCBldGNoLmRlc3Ryb3kodGhpcylcbiAgICB0aGlzLmRpc3Bvc2FibGVzLmRpc3Bvc2UoKVxuICAgIHRoaXMucGFuZWwuZGVzdHJveSgpXG4gICAgdGhpcy5zdGF0dXNNYXAuY2xlYXIoKVxuICB9XG5cbiAgcHVibGljIGFkZFBhbmVsQ29udHJvbCAoZWxlbWVudDogc3RyaW5nIHwgRnVuY3Rpb24sIG9wdHM6IElDb250cm9sT3B0cyB8IE9iamVjdCkge1xuICAgIGlmICh0eXBlb2YgZWxlbWVudCA9PT0gJ3N0cmluZycpIHtcbiAgICAgIGNvbnN0IHtldmVudHMsIGNsYXNzZXMsIHN0eWxlLCBhdHRyc30gPSAob3B0cyBhcyBJQ29udHJvbE9wdHMpXG4gICAgICBjb25zdCBwcm9wczogYW55ID0ge31cbiAgICAgIGlmIChjbGFzc2VzKSB7IHByb3BzLmNsYXNzID0gY2xhc3Nlcy5qb2luKCcgJykgfVxuICAgICAgaWYgKHN0eWxlKSB7IHByb3BzLnN0eWxlID0gc3R5bGUgfVxuICAgICAgaWYgKGF0dHJzKSB7IHByb3BzLmF0dHJpYnV0ZXMgPSBhdHRycyB9XG4gICAgICBpZiAoZXZlbnRzKSB7IHByb3BzLm9uID0gZXZlbnRzIH1cblxuICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCwgcHJvcHMpXG4gICAgfSBlbHNlIHtcbiAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQsIG9wdHMpXG4gICAgfVxuICAgIHRoaXMuZWxlbWVudHMuYWRkKGVsZW1lbnQpXG4gICAgdGhpcy51cGRhdGUoKVxuICAgIHJldHVybiBuZXcgRGlzcG9zYWJsZSgoKSA9PiB7XG4gICAgICB0aGlzLmVsZW1lbnRzLmRlbGV0ZShlbGVtZW50KVxuICAgICAgdGhpcy51cGRhdGUoKVxuICAgIH0pXG4gIH1cblxuICBwdWJsaWMgdXBkYXRlSXRlbXMgKCkge1xuICAgIGNvbnN0IGFjdGl2ZVRhYiA9IHRoaXMuZ2V0QWN0aXZlVGFiKClcbiAgICBsZXQgY3VycmVudFVyaTogc3RyaW5nXG4gICAgaWYgKGFjdGl2ZVRhYikge1xuICAgICAgdGhpcy5oaWRkZW5PdXRwdXQgPSBmYWxzZVxuICAgICAgbGV0IGZpbHRlclVyaTogc3RyaW5nIHwgdW5kZWZpbmVkXG4gICAgICBjb25zdCBmaWx0ZXJTZXZlcml0eSA9IGFjdGl2ZVRhYlxuICAgICAgY29uc3QgYXRvID0gdGhpcy5yZWZzLmJ1dHRvbnMub3B0aW9ucyhhY3RpdmVUYWIpXG4gICAgICBpZiAodGhpcy5yZWZzLmNoZWNrYm94VXJpRmlsdGVyLmdldEZpbGVGaWx0ZXIoKSkge1xuICAgICAgICBjdXJyZW50VXJpID0gYXRvbS53b3Jrc3BhY2UuZ2V0QWN0aXZlVGV4dEVkaXRvcigpLmdldFBhdGgoKVxuICAgICAgICBpZiAoY3VycmVudFVyaSAmJiBhdG8gJiYgYXRvLnVyaUZpbHRlcikge1xuICAgICAgICAgIGZpbHRlclVyaSA9IGN1cnJlbnRVcmlcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY29uc3Qgc2Nyb2xsID0gYXRvICYmIGF0by5hdXRvU2Nyb2xsICYmIHRoaXMucmVmcy5pdGVtcy5hdEVuZCgpXG4gICAgICB0aGlzLnJlZnMuaXRlbXMuZmlsdGVyKCh7dXJpLCBzZXZlcml0eX0pID0+XG4gICAgICAgIChzZXZlcml0eSA9PT0gZmlsdGVyU2V2ZXJpdHkpICYmICghZmlsdGVyVXJpIHx8IHVyaSA9PT0gZmlsdGVyVXJpKVxuICAgICAgKVxuICAgICAgaWYgKHNjcm9sbCkgeyB0aGlzLnJlZnMuaXRlbXMuc2Nyb2xsVG9FbmQoKSB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuaGlkZGVuT3V0cHV0ID0gdHJ1ZVxuICAgIH1cblxuICAgIHRoaXMucmVmcy5idXR0b25zLmJ1dHRvbk5hbWVzKCkuZm9yRWFjaCgoYnRuKSA9PiB7XG4gICAgICBjb25zdCBmOiB7c2V2ZXJpdHk6IHN0cmluZywgdXJpPzogc3RyaW5nfSA9IHtzZXZlcml0eTogYnRufVxuICAgICAgY29uc3QgYXRvID0gdGhpcy5yZWZzLmJ1dHRvbnMub3B0aW9ucyhidG4pXG4gICAgICBpZiAoY3VycmVudFVyaSAmJiBhdG8gJiYgYXRvLnVyaUZpbHRlcikgeyBmLnVyaSA9IGN1cnJlbnRVcmkgfVxuICAgICAgdGhpcy5yZWZzLmJ1dHRvbnMuc2V0Q291bnQoYnRuLCB0aGlzLnJlc3VsdHMuZmlsdGVyKFxuICAgICAgICAoe3VyaSwgc2V2ZXJpdHl9KSA9PiAoc2V2ZXJpdHkgPT09IGYuc2V2ZXJpdHkpICYmICghZi51cmkgfHwgdXJpID09PSBmLnVyaSlcbiAgICAgICkubGVuZ3RoKVxuICAgIH0pXG4gICAgdGhpcy51cGRhdGUoKVxuICB9XG5cbiAgcHVibGljIGFjdGl2YXRlVGFiICh0YWI6IHN0cmluZykge1xuICAgIHRoaXMucmVmcy5idXR0b25zLmNsaWNrQnV0dG9uKHRhYilcbiAgfVxuXG4gIHB1YmxpYyBhY3RpdmF0ZUZpcnN0Tm9uRW1wdHlUYWIgKHR5cGVzOiBzdHJpbmdbXSkge1xuICAgIGNvbnN0IG5hbWVzID0gdGhpcy5yZWZzLmJ1dHRvbnMuYnV0dG9uTmFtZXMoKVxuICAgIGZvciAoY29uc3QgaSBvZiBuYW1lcykge1xuICAgICAgY29uc3QgbmFtZSA9IG5hbWVzW2ldXG4gICAgICBpZiAoIXR5cGVzIHx8IHR5cGVzLmluY2x1ZGVzKG5hbWUpKSB7XG4gICAgICAgIGlmICgodGhpcy5yZXN1bHRzLmZpbHRlcigoe3NldmVyaXR5fSkgPT4gc2V2ZXJpdHkgPT09IG5hbWUpKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgdGhpcy5hY3RpdmF0ZVRhYihuYW1lKVxuICAgICAgICAgIGJyZWFrXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwdWJsaWMgc2hvd0l0ZW0gKGl0ZW06IFJlc3VsdEl0ZW0pIHtcbiAgICB0aGlzLmFjdGl2YXRlVGFiKGl0ZW0uc2V2ZXJpdHkpXG4gICAgdGhpcy5yZWZzLml0ZW1zLnNob3dJdGVtKGl0ZW0pXG4gIH1cblxuICBwdWJsaWMgZ2V0QWN0aXZlVGFiICgpIHtcbiAgICByZXR1cm4gdGhpcy5yZWZzLmJ1dHRvbnMuZ2V0QWN0aXZlKClcbiAgfVxuXG4gIHB1YmxpYyBjcmVhdGVUYWIgKG5hbWU6IHN0cmluZywgb3B0czogSVNldmVyaXR5VGFiRGVmaW5pdGlvbikge1xuICAgIGlmICghdGhpcy5yZWZzLmJ1dHRvbnMuYnV0dG9uTmFtZXMoKS5pbmNsdWRlcyhuYW1lKSkge1xuICAgICAgdGhpcy5yZWZzLmJ1dHRvbnMuY3JlYXRlQnV0dG9uKG5hbWUsIG9wdHMpXG4gICAgICB0aGlzLnN0YXRlLmFjdGl2ZVRhYiAmJiB0aGlzLmFjdGl2YXRlVGFiKHRoaXMuc3RhdGUuYWN0aXZlVGFiKVxuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBzZXRQcm9ncmVzcyAocHJvZ3Jlc3M6IG51bWJlcikge1xuICAgIHRoaXMucmVmcy5wcm9ncmVzc0Jhci5zZXRQcm9ncmVzcyhwcm9ncmVzcylcbiAgfVxuXG4gIHB1YmxpYyB0b2dnbGUgKCkge1xuICAgIGlmICh0aGlzLnBhbmVsLmlzVmlzaWJsZSgpKSB7XG4gICAgICB0aGlzLnBhbmVsLmhpZGUoKVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnBhbmVsLnNob3coKVxuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBzZXJpYWxpemUgKCkge1xuICAgIHJldHVybiB7XG4gICAgICB2aXNpYmlsaXR5OiB0aGlzLnBhbmVsLmlzVmlzaWJsZSgpLFxuICAgICAgaGVpZ2h0OiB0aGlzLmVsZW1lbnQgJiYgdGhpcy5lbGVtZW50LnN0eWxlLmhlaWdodCB8fCB0aGlzLnN0YXRlLmhlaWdodCxcbiAgICAgIHdpZHRoOiB0aGlzLmVsZW1lbnQgJiYgdGhpcy5lbGVtZW50LnN0eWxlLndpZHRoIHx8IHRoaXMuc3RhdGUud2lkdGgsXG4gICAgICBhY3RpdmVUYWI6IHRoaXMuZ2V0QWN0aXZlVGFiKCksXG4gICAgICBmaWxlRmlsdGVyOiB0aGlzLnJlZnMuY2hlY2tib3hVcmlGaWx0ZXIuZ2V0RmlsZUZpbHRlcigpXG4gICAgfVxuICB9XG5cbiAgcHVibGljIGJhY2tlbmRTdGF0dXMgKHBsdWdpbk5hbWU6IHN0cmluZywgc3Q6IElTdGF0dXMpIHtcbiAgICBjb25zdCBwcmlvID0ge1xuICAgICAgcHJvZ3Jlc3M6IDUsXG4gICAgICBlcnJvcjogMjAsXG4gICAgICB3YXJuaW5nOiAxMCxcbiAgICAgIHJlYWR5OiAwXG4gICAgfVxuICAgIHRoaXMuc3RhdHVzTWFwLnNldChwbHVnaW5OYW1lLCBzdClcbiAgICBjb25zdCBzdEFyciA9IEFycmF5LmZyb20odGhpcy5zdGF0dXNNYXAudmFsdWVzKCkpXG4gICAgY29uc3QgW2NvbnNlbnN1c10gPSBzdEFyci5zb3J0KChhLCBiKSA9PiBwcmlvW2Iuc3RhdHVzXSAtIHByaW9bYS5zdGF0dXNdKVxuICAgIHRoaXMucmVmcy5zdGF0dXMuc2V0QXR0cmlidXRlKCdkYXRhLXN0YXR1cycsIGNvbnNlbnN1cy5zdGF0dXMpXG4gICAgbGV0IGNvdW50ID0gMFxuICAgIGxldCB0b3QgPSAwXG4gICAgZm9yIChjb25zdCBpIG9mIHN0QXJyKSB7XG4gICAgICBpZiAoaS5zdGF0dXMgPT09ICdwcm9ncmVzcycgJiYgaS5wcm9ncmVzcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRvdCArPSBpLnByb2dyZXNzXG4gICAgICAgIGNvdW50KytcbiAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgcHJvZ3Jlc3NBdmUgPSB0b3QgLyBjb3VudFxuICAgIHRoaXMuc2V0UHJvZ3Jlc3MocHJvZ3Jlc3NBdmUpXG4gIH1cblxuICBwdWJsaWMgc2hvd05leHRFcnJvciAoKSB7XG4gICAgY29uc3QgcnMgPSB0aGlzLnJlc3VsdHMuZmlsdGVyKCh7dXJpfSkgPT4gISF1cmkpXG4gICAgaWYgKHJzLmxlbmd0aCA9PT0gMCkgeyByZXR1cm4gfVxuXG4gICAgaWYgKHRoaXMuY3VycmVudFJlc3VsdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aGlzLmN1cnJlbnRSZXN1bHQrK1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmN1cnJlbnRSZXN1bHQgPSAwXG4gICAgfVxuICAgIGlmICh0aGlzLmN1cnJlbnRSZXN1bHQgPj0gcnMubGVuZ3RoKSB7IHRoaXMuY3VycmVudFJlc3VsdCA9IDAgfVxuXG4gICAgdGhpcy5zaG93SXRlbShyc1t0aGlzLmN1cnJlbnRSZXN1bHRdKVxuICB9XG5cbiAgcHVibGljIHNob3dQcmV2RXJyb3IgKCkge1xuICAgIGNvbnN0IHJzID0gdGhpcy5yZXN1bHRzLmZpbHRlcigoe3VyaX0pID0+ICEhdXJpKVxuICAgIGlmIChycy5sZW5ndGggPT09IDApIHsgcmV0dXJuIH1cblxuICAgIGlmICh0aGlzLmN1cnJlbnRSZXN1bHQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5jdXJyZW50UmVzdWx0LS1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jdXJyZW50UmVzdWx0ID0gcnMubGVuZ3RoIC0gMVxuICAgIH1cbiAgICBpZiAodGhpcy5jdXJyZW50UmVzdWx0IDwgMCkgeyB0aGlzLmN1cnJlbnRSZXN1bHQgPSBycy5sZW5ndGggLSAxIH1cblxuICAgIHRoaXMuc2hvd0l0ZW0ocnNbdGhpcy5jdXJyZW50UmVzdWx0XSlcbiAgfVxuXG4gIHByaXZhdGUgcmVzaXplU3RhcnQgKGU6IE1vdXNlRXZlbnQpIHtcbiAgICBpZiAoIXRoaXMuZWxlbWVudCkgeyByZXR1cm4gfVxuICAgIGNvbnN0IHZhcnNNYXAgPSB7XG4gICAgICB0b3A6IHtheGlzOiAnWScsIHBhcmFtOiAnaGVpZ2h0JywgZGlyOiAxfSxcbiAgICAgIGJvdHRvbToge2F4aXM6ICdZJywgcGFyYW06ICdoZWlnaHQnLCBkaXI6IC0xfSxcbiAgICAgIGxlZnQ6IHtheGlzOiAnWCcsIHBhcmFtOiAnd2lkdGgnLCBkaXI6IDF9LFxuICAgICAgcmlnaHQ6IHtheGlzOiAnWCcsIHBhcmFtOiAnd2lkdGgnLCBkaXI6IC0xfVxuICAgIH1cblxuICAgIGNvbnN0IHZhcnMgPSB2YXJzTWFwW3RoaXMucG9zXVxuXG4gICAgdmFycy5heGlzID0gYGNsaWVudCR7dmFycy5heGlzfWBcbiAgICBjb25zdCBzdGFydEF4aXMgPSBlW3ZhcnMuYXhpc11cbiAgICBjb25zdCBzdGFydFBhcmFtID0gcGFyc2VJbnQoZG9jdW1lbnQuZGVmYXVsdFZpZXcuZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzLmVsZW1lbnQpW3ZhcnMucGFyYW1dLCAxMClcblxuICAgIGNvbnN0IGRvRHJhZyA9IChldmVudDogTW91c2VFdmVudCkgPT4ge1xuICAgICAgdGhpcy5zdGF0ZVt2YXJzLnBhcmFtXSA9XG4gICAgICAgIChzdGFydFBhcmFtICsgdmFycy5kaXIgKiAoZXZlbnRbdmFycy5heGlzXSAtIHN0YXJ0QXhpcykpICsgJ3B4J1xuICAgICAgdGhpcy51cGRhdGUoKVxuICAgIH1cbiAgICBjb25zdCBzdG9wRHJhZyA9ICgpID0+IHtcbiAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBkb0RyYWcpXG4gICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHN0b3BEcmFnKVxuICAgIH1cblxuICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBkb0RyYWcpXG4gICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBzdG9wRHJhZylcbiAgfVxufVxuIl19