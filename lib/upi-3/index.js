"use strict";
function __export(m) {
    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];
}
Object.defineProperty(exports, "__esModule", { value: true });
const atom_1 = require("atom");
const utils_1 = require("../utils");
__export(require("./instance"));
function consume(pluginManager, options) {
    const { name, menu, messageTypes, events, controls, params, tooltip } = options;
    const disp = new atom_1.CompositeDisposable();
    if (menu) {
        const menuDisp = atom.menu.add([{
                label: utils_1.MAIN_MENU_LABEL,
                submenu: [{ label: menu.label, submenu: menu.menu }]
            }]);
        disp.add(menuDisp);
    }
    if (messageTypes) {
        for (const type of Object.keys(messageTypes)) {
            const opts = messageTypes[type];
            pluginManager.outputPanel.createTab(type, opts);
        }
    }
    if (events) {
        for (const k in events) {
            if (k.startsWith('on') && pluginManager[k]) {
                let v = events[k];
                if (!Array.isArray(v)) {
                    v = [v];
                }
                for (const i of v) {
                    disp.add(pluginManager[k](i));
                }
            }
        }
    }
    if (tooltip) {
        let handler, priority;
        if (typeof tooltip === 'function') {
            handler = tooltip;
        }
        else {
            ({ handler, priority } = tooltip);
        }
        if (!priority) {
            priority = 100;
        }
        disp.add(pluginManager.tooltipRegistry.register(name, { priority, handler }));
    }
    if (controls) {
        for (const { element, opts } of controls) {
            if (typeof element === 'string') {
                disp.add(pluginManager.outputPanel.addPanelControl(element, opts));
            }
            else {
                disp.add(pluginManager.outputPanel.addPanelControl(element, opts));
            }
        }
    }
    if (params) {
        for (const paramName of Object.keys(params)) {
            const spec = params[paramName];
            disp.add(pluginManager.configParamManager.add(this.pluginName, paramName, spec));
        }
    }
    return disp;
}
exports.consume = consume;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdXBpLTMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSwrQkFBb0Q7QUFPcEQsb0NBQXdDO0FBRXhDLGdDQUEwQjtBQTBDMUIsaUJBQXlCLGFBQTRCLEVBQUUsT0FBNkI7SUFDbEYsTUFBTSxFQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsWUFBWSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBQyxHQUFHLE9BQU8sQ0FBQTtJQUM3RSxNQUFNLElBQUksR0FBRyxJQUFJLDBCQUFtQixFQUFFLENBQUE7SUFFdEMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUNULE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQzlCLEtBQUssRUFBRSx1QkFBZTtnQkFDdEIsT0FBTyxFQUFFLENBQUUsRUFBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBQyxDQUFFO2FBQ3JELENBQUMsQ0FBQyxDQUFBO1FBQ0gsSUFBSSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQTtJQUNwQixDQUFDO0lBQ0QsRUFBRSxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztRQUVqQixHQUFHLENBQUMsQ0FBQyxNQUFNLElBQUksSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM3QyxNQUFNLElBQUksR0FBRyxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUE7WUFDL0IsYUFBYSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFBO1FBQ2pELENBQUM7SUFDSCxDQUFDO0lBQ0QsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztRQUNYLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDdkIsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUMzQyxJQUFJLENBQUMsR0FBZ0QsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFBO2dCQUM5RCxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFBO2dCQUFDLENBQUM7Z0JBQ2xDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQ2xCLElBQUksQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7Z0JBQy9CLENBQUM7WUFDSCxDQUFDO1FBQ0gsQ0FBQztJQUNILENBQUM7SUFDRCxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1FBQ1osSUFBSSxPQUF3QixFQUFFLFFBQTRCLENBQUE7UUFDMUQsRUFBRSxDQUFDLENBQUMsT0FBTyxPQUFPLEtBQUssVUFBVSxDQUFDLENBQUMsQ0FBQztZQUNsQyxPQUFPLEdBQUcsT0FBTyxDQUFBO1FBQ25CLENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNOLENBQUMsRUFBQyxPQUFPLEVBQUUsUUFBUSxFQUFDLEdBQUcsT0FBTyxDQUFDLENBQUE7UUFDakMsQ0FBQztRQUNELEVBQUUsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztZQUFDLFFBQVEsR0FBRyxHQUFHLENBQUE7UUFBQyxDQUFDO1FBQ2pDLElBQUksQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLEVBQUMsUUFBUSxFQUFFLE9BQU8sRUFBQyxDQUFDLENBQUMsQ0FBQTtJQUM3RSxDQUFDO0lBQ0QsRUFBRSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztRQUNiLEdBQUcsQ0FBQyxDQUFDLE1BQU0sRUFBQyxPQUFPLEVBQUUsSUFBSSxFQUFDLElBQUksUUFBUSxDQUFDLENBQUMsQ0FBQztZQUN2QyxFQUFFLENBQUMsQ0FBQyxPQUFPLE9BQU8sS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDO2dCQUNoQyxJQUFJLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsZUFBZSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFBO1lBQ3BFLENBQUM7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDTixJQUFJLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsZUFBZSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFBO1lBQ3BFLENBQUM7UUFDSCxDQUFDO0lBQ0gsQ0FBQztJQUNELEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDWCxHQUFHLENBQUMsQ0FBQyxNQUFNLFNBQVMsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM1QyxNQUFNLElBQUksR0FBRyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUE7WUFDOUIsSUFBSSxDQUFDLEdBQUcsQ0FDTixhQUFhLENBQUMsa0JBQWtCLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsU0FBUyxFQUFFLElBQUksQ0FBQyxDQUN2RSxDQUFBO1FBQ0gsQ0FBQztJQUNILENBQUM7SUFFRCxNQUFNLENBQUMsSUFBSSxDQUFBO0FBQ2IsQ0FBQztBQTFERCwwQkEwREMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NvbXBvc2l0ZURpc3Bvc2FibGUsIERpc3Bvc2FibGV9IGZyb20gJ2F0b20nXG5cbmltcG9ydCB7UGx1Z2luTWFuYWdlcn0gZnJvbSAnLi4vcGx1Z2luLW1hbmFnZXInXG5pbXBvcnQge1RUZXh0QnVmZmVyQ2FsbGJhY2t9IGZyb20gJy4uL2VkaXRvci1jb250cm9sJ1xuaW1wb3J0IHtJU2V0VHlwZXNQYXJhbXMsIElDb250cm9sT3B0cywgSUVsZW1lbnRPYmplY3R9IGZyb20gJy4uL291dHB1dC1wYW5lbCdcbmltcG9ydCB7SVBhcmFtU3BlY30gZnJvbSAnLi4vY29uZmlnLXBhcmFtcydcbmltcG9ydCB7VFRvb2x0aXBIYW5kbGVyfSBmcm9tICcuLi90b29sdGlwLXJlZ2lzdHJ5J1xuaW1wb3J0IHtNQUlOX01FTlVfTEFCRUx9IGZyb20gJy4uL3V0aWxzJ1xuXG5leHBvcnQgKiBmcm9tICcuL2luc3RhbmNlJ1xuXG5leHBvcnQgaW50ZXJmYWNlIElBdG9tTWVudUNvbW1hbmQge1xuICBsYWJlbDogc3RyaW5nXG4gIGNvbW1hbmQ6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIElBdG9tU3VibWVudSB7XG4gIGxhYmVsOiBzdHJpbmdcbiAgc3VibWVudTogVEF0b21NZW51W11cbn1cblxuZXhwb3J0IGludGVyZmFjZSBJVVBJQ29udHJvbFNpbXBsZURlZmluaXRpb24ge1xuICBlbGVtZW50OiBzdHJpbmdcbiAgb3B0czogSUNvbnRyb2xPcHRzXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSVVQSUNvbnRyb2xDdXN0b21EZWZpbml0aW9uPFQ+IHtcbiAgZWxlbWVudDogeyBuZXcgKGFyZzogVCk6IElFbGVtZW50T2JqZWN0PFQ+IH1cbiAgb3B0czogVFxufVxuXG5leHBvcnQgdHlwZSBUVVBJQ29udHJvbERlZmluaXRpb24gPSBJVVBJQ29udHJvbEN1c3RvbURlZmluaXRpb248T2JqZWN0PiB8IElVUElDb250cm9sU2ltcGxlRGVmaW5pdGlvblxuXG5leHBvcnQgdHlwZSBUQXRvbU1lbnUgPSBJQXRvbU1lbnVDb21tYW5kIHwgSUF0b21TdWJtZW51XG5cbmV4cG9ydCB0eXBlIFRTaW5nbGVPckFycmF5PFQ+ID0gVCB8IFRbXVxuXG5leHBvcnQgaW50ZXJmYWNlIElSZWdpc3RyYXRpb25PcHRpb25zIHtcbiAgbmFtZTogc3RyaW5nXG4gIG1lbnU/OiB7bGFiZWw6IHN0cmluZywgbWVudTogVEF0b21NZW51fVxuICBtZXNzYWdlVHlwZXM/OiBJU2V0VHlwZXNQYXJhbXNcbiAgZXZlbnRzPzoge1xuICAgIG9uV2lsbFNhdmVCdWZmZXI/OiBUU2luZ2xlT3JBcnJheTxUVGV4dEJ1ZmZlckNhbGxiYWNrPlxuICAgIG9uRGlkU2F2ZUJ1ZmZlcj86IFRTaW5nbGVPckFycmF5PFRUZXh0QnVmZmVyQ2FsbGJhY2s+XG4gICAgb25EaWRTdG9wQ2hhbmdpbmc/OiBUU2luZ2xlT3JBcnJheTxUVGV4dEJ1ZmZlckNhbGxiYWNrPlxuICB9XG4gIGNvbnRyb2xzPzogVFVQSUNvbnRyb2xEZWZpbml0aW9uW11cbiAgcGFyYW1zPzoge1twYXJhbU5hbWU6IHN0cmluZ106IElQYXJhbVNwZWM8T2JqZWN0Pn1cbiAgdG9vbHRpcD86IFRUb29sdGlwSGFuZGxlciB8IHtwcmlvcml0eT86IG51bWJlciwgaGFuZGxlcjogVFRvb2x0aXBIYW5kbGVyfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gY29uc3VtZSAocGx1Z2luTWFuYWdlcjogUGx1Z2luTWFuYWdlciwgb3B0aW9uczogSVJlZ2lzdHJhdGlvbk9wdGlvbnMpOiBEaXNwb3NhYmxlIHtcbiAgY29uc3Qge25hbWUsIG1lbnUsIG1lc3NhZ2VUeXBlcywgZXZlbnRzLCBjb250cm9scywgcGFyYW1zLCB0b29sdGlwfSA9IG9wdGlvbnNcbiAgY29uc3QgZGlzcCA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKClcblxuICBpZiAobWVudSkge1xuICAgIGNvbnN0IG1lbnVEaXNwID0gYXRvbS5tZW51LmFkZChbe1xuICAgICAgbGFiZWw6IE1BSU5fTUVOVV9MQUJFTCxcbiAgICAgIHN1Ym1lbnU6IFsge2xhYmVsOiBtZW51LmxhYmVsLCBzdWJtZW51OiBtZW51Lm1lbnV9IF1cbiAgICB9XSlcbiAgICBkaXNwLmFkZChtZW51RGlzcClcbiAgfVxuICBpZiAobWVzc2FnZVR5cGVzKSB7XG4gICAgLy8gVE9ETzogbWFrZSBkaXNwb3NhYmxlXG4gICAgZm9yIChjb25zdCB0eXBlIG9mIE9iamVjdC5rZXlzKG1lc3NhZ2VUeXBlcykpIHtcbiAgICAgIGNvbnN0IG9wdHMgPSBtZXNzYWdlVHlwZXNbdHlwZV1cbiAgICAgIHBsdWdpbk1hbmFnZXIub3V0cHV0UGFuZWwuY3JlYXRlVGFiKHR5cGUsIG9wdHMpXG4gICAgfVxuICB9XG4gIGlmIChldmVudHMpIHtcbiAgICBmb3IgKGNvbnN0IGsgaW4gZXZlbnRzKSB7XG4gICAgICBpZiAoay5zdGFydHNXaXRoKCdvbicpICYmIHBsdWdpbk1hbmFnZXJba10pIHtcbiAgICAgICAgbGV0IHY6IFRUZXh0QnVmZmVyQ2FsbGJhY2sgfCBUVGV4dEJ1ZmZlckNhbGxiYWNrW10gPSBldmVudHNba11cbiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHYpKSB7IHYgPSBbdl0gfVxuICAgICAgICBmb3IgKGNvbnN0IGkgb2Ygdikge1xuICAgICAgICAgIGRpc3AuYWRkKHBsdWdpbk1hbmFnZXJba10oaSkpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgaWYgKHRvb2x0aXApIHtcbiAgICBsZXQgaGFuZGxlcjogVFRvb2x0aXBIYW5kbGVyLCBwcmlvcml0eTogbnVtYmVyIHwgdW5kZWZpbmVkXG4gICAgaWYgKHR5cGVvZiB0b29sdGlwID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBoYW5kbGVyID0gdG9vbHRpcFxuICAgIH0gZWxzZSB7XG4gICAgICAoe2hhbmRsZXIsIHByaW9yaXR5fSA9IHRvb2x0aXApXG4gICAgfVxuICAgIGlmICghcHJpb3JpdHkpIHsgcHJpb3JpdHkgPSAxMDAgfVxuICAgIGRpc3AuYWRkKHBsdWdpbk1hbmFnZXIudG9vbHRpcFJlZ2lzdHJ5LnJlZ2lzdGVyKG5hbWUsIHtwcmlvcml0eSwgaGFuZGxlcn0pKVxuICB9XG4gIGlmIChjb250cm9scykge1xuICAgIGZvciAoY29uc3Qge2VsZW1lbnQsIG9wdHN9IG9mIGNvbnRyb2xzKSB7XG4gICAgICBpZiAodHlwZW9mIGVsZW1lbnQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGRpc3AuYWRkKHBsdWdpbk1hbmFnZXIub3V0cHV0UGFuZWwuYWRkUGFuZWxDb250cm9sKGVsZW1lbnQsIG9wdHMpKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZGlzcC5hZGQocGx1Z2luTWFuYWdlci5vdXRwdXRQYW5lbC5hZGRQYW5lbENvbnRyb2woZWxlbWVudCwgb3B0cykpXG4gICAgICB9XG4gICAgfVxuICB9XG4gIGlmIChwYXJhbXMpIHtcbiAgICBmb3IgKGNvbnN0IHBhcmFtTmFtZSBvZiBPYmplY3Qua2V5cyhwYXJhbXMpKSB7XG4gICAgICBjb25zdCBzcGVjID0gcGFyYW1zW3BhcmFtTmFtZV1cbiAgICAgIGRpc3AuYWRkKFxuICAgICAgICBwbHVnaW5NYW5hZ2VyLmNvbmZpZ1BhcmFtTWFuYWdlci5hZGQodGhpcy5wbHVnaW5OYW1lLCBwYXJhbU5hbWUsIHNwZWMpXG4gICAgICApXG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGRpc3Bcbn1cbiJdfQ==