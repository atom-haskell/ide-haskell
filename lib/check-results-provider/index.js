"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const atom_1 = require("atom");
class MarkerManager {
    constructor(editor, results, tooltipRegistry) {
        this.editor = editor;
        this.results = results;
        this.tooltipRegistry = tooltipRegistry;
        this.gutter = this.editor.gutterWithName('ide-haskell-check-results');
        this.disposables = new atom_1.CompositeDisposable();
        this.markers = editor.addMarkerLayer({
            maintainHistory: true,
            persistent: false
        });
        this.markerProps = new WeakMap();
        this.disposables.add(results.onDidUpdate(this.updateResults.bind(this)));
        this.disposables.add(tooltipRegistry.register('builtin:check-results', {
            priority: 200,
            handler: this.tooltipProvider.bind(this)
        }));
    }
    dispose() {
        this.markers.destroy();
        this.disposables.dispose();
    }
    tooltipProvider(editor, crange, type) {
        const msg = this.getMessageAt(crange.start, type);
        if (msg.length > 0) {
            return { range: crange, text: msg };
        }
    }
    getMessageAt(pos, type) {
        const markers = this.find(pos, type);
        const result = [];
        for (const marker of markers) {
            const res = this.markerProps.get(marker);
            if (!res) {
                continue;
            }
            result.push(res.message);
        }
        return result;
    }
    updateResults() {
        this.markers.clear();
        const path = this.editor.getPath();
        for (const res of this.results.filter(({ uri }) => uri === path)) {
            this.markerFromCheckResult(res);
        }
    }
    markerFromCheckResult(resItem) {
        const { position } = resItem;
        if (!position) {
            return;
        }
        const range = new atom_1.Range(position, atom_1.Point.fromObject([position.row, position.column + 1]));
        const marker = this.markers.markBufferRange(range, { invalidate: 'touch' });
        this.markerProps.set(marker, resItem);
        const disp = marker.onDidChange(({ isValid }) => {
            if (!isValid) {
                this.markerProps.delete(marker);
                resItem.destroy();
                marker.destroy();
                disp.dispose();
            }
        });
        this.decorateMarker(marker, resItem);
    }
    decorateMarker(m, r) {
        if (!this.gutter) {
            return;
        }
        const cls = { class: `ide-haskell-${r.severity}` };
        this.gutter.decorateMarker(m, Object.assign({ type: 'line-number' }, cls));
        this.editor.decorateMarker(m, Object.assign({ type: 'highlight' }, cls));
        this.editor.decorateMarker(m, Object.assign({ type: 'line' }, cls));
    }
    find(pos, type) {
        switch (type) {
            case 'gutter':
            case 'selection':
                return this.markers.findMarkers({ startBufferRow: pos.row });
            case 'keyboard':
                return this.markers.findMarkers({ startBufferPosition: pos });
            case 'mouse':
            case 'context':
                return this.markers.findMarkers({ containsBufferPosition: pos });
            default: throw new TypeError('Switch assertion failed');
        }
    }
}
exports.MarkerManager = MarkerManager;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvY2hlY2stcmVzdWx0cy1wcm92aWRlci9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLCtCQUdhO0FBUWI7SUFLRSxZQUFxQixNQUFrQixFQUFVLE9BQWtCLEVBQVUsZUFBZ0M7UUFBeEYsV0FBTSxHQUFOLE1BQU0sQ0FBWTtRQUFVLFlBQU8sR0FBUCxPQUFPLENBQVc7UUFBVSxvQkFBZSxHQUFmLGVBQWUsQ0FBaUI7UUFDM0csSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQywyQkFBMkIsQ0FBQyxDQUFBO1FBRXJFLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSwwQkFBbUIsRUFBRSxDQUFBO1FBQzVDLElBQUksQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDLGNBQWMsQ0FBQztZQUNuQyxlQUFlLEVBQUUsSUFBSTtZQUNyQixVQUFVLEVBQUUsS0FBSztTQUNsQixDQUFDLENBQUE7UUFDRixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksT0FBTyxFQUFFLENBQUE7UUFDaEMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFDeEUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyx1QkFBdUIsRUFBRTtZQUNyRSxRQUFRLEVBQUUsR0FBRztZQUNiLE9BQU8sRUFBRSxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7U0FDekMsQ0FBQyxDQUFDLENBQUE7SUFDTCxDQUFDO0lBRU0sT0FBTztRQUNaLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUE7UUFDdEIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLEVBQUUsQ0FBQTtJQUM1QixDQUFDO0lBRU8sZUFBZSxDQUFFLE1BQWtCLEVBQUUsTUFBYSxFQUFFLElBQXFCO1FBQy9FLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQTtRQUNqRCxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbkIsTUFBTSxDQUFDLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLENBQUE7UUFDckMsQ0FBQztJQUNILENBQUM7SUFFTyxZQUFZLENBQUUsR0FBVSxFQUFFLElBQXFCO1FBQ3JELE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFBO1FBQ3BDLE1BQU0sTUFBTSxHQUFvQixFQUFFLENBQUE7UUFDbEMsR0FBRyxDQUFDLENBQUMsTUFBTSxNQUFNLElBQUksT0FBTyxDQUFDLENBQUMsQ0FBQztZQUM3QixNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQTtZQUN4QyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQUMsUUFBUSxDQUFBO1lBQUMsQ0FBQztZQUN0QixNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQTtRQUMxQixDQUFDO1FBQ0QsTUFBTSxDQUFDLE1BQU0sQ0FBQTtJQUNmLENBQUM7SUFFTyxhQUFhO1FBQ25CLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUE7UUFDcEIsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsQ0FBQTtRQUNsQyxHQUFHLENBQUMsQ0FBQyxNQUFNLEdBQUcsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUMsR0FBRyxFQUFDLEtBQUssR0FBRyxLQUFLLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMvRCxJQUFJLENBQUMscUJBQXFCLENBQUMsR0FBRyxDQUFDLENBQUE7UUFDakMsQ0FBQztJQUNILENBQUM7SUFFTyxxQkFBcUIsQ0FBRSxPQUFtQjtRQUNoRCxNQUFNLEVBQUMsUUFBUSxFQUFDLEdBQUcsT0FBTyxDQUFBO1FBQzFCLEVBQUUsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztZQUFDLE1BQU0sQ0FBQTtRQUFDLENBQUM7UUFFekIsTUFBTSxLQUFLLEdBQUcsSUFBSSxZQUFLLENBQUMsUUFBUSxFQUFFLFlBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQyxRQUFRLENBQUMsR0FBRyxFQUFFLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFBO1FBQ3hGLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsZUFBZSxDQUFDLEtBQUssRUFBRSxFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFBO1FBQzNFLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQTtRQUNyQyxNQUFNLElBQUksR0FBRyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsRUFBQyxPQUFPLEVBQWdCO1lBQ3ZELEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztnQkFDYixJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQTtnQkFDL0IsT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFBO2dCQUNqQixNQUFNLENBQUMsT0FBTyxFQUFFLENBQUE7Z0JBQ2hCLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQTtZQUNoQixDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUE7UUFDRixJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQTtJQUN0QyxDQUFDO0lBRU8sY0FBYyxDQUFFLENBQWdCLEVBQUUsQ0FBYTtRQUNyRCxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQ2pCLE1BQU0sQ0FBQTtRQUNSLENBQUM7UUFDRCxNQUFNLEdBQUcsR0FBRyxFQUFDLEtBQUssRUFBRSxlQUFlLENBQUMsQ0FBQyxRQUFRLEVBQUUsRUFBQyxDQUFBO1FBQ2hELElBQUksQ0FBQyxNQUFNLENBQUMsY0FBYyxDQUFDLENBQUMsa0JBQUksSUFBSSxFQUFFLGFBQWEsSUFBSyxHQUFHLEVBQUcsQ0FBQTtRQUM5RCxJQUFJLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDLGtCQUFJLElBQUksRUFBRSxXQUFXLElBQUssR0FBRyxFQUFHLENBQUE7UUFDNUQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQyxrQkFBSSxJQUFJLEVBQUUsTUFBTSxJQUFLLEdBQUcsRUFBRyxDQUFBO0lBQ3pELENBQUM7SUFFTyxJQUFJLENBQUUsR0FBVSxFQUFFLElBQXFCO1FBQzdDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDYixLQUFLLFFBQVEsQ0FBQztZQUNkLEtBQUssV0FBVztnQkFDZCxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsRUFBRSxjQUFjLEVBQUUsR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUE7WUFDOUQsS0FBSyxVQUFVO2dCQUNiLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxFQUFFLG1CQUFtQixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUE7WUFDL0QsS0FBSyxPQUFPLENBQUM7WUFDYixLQUFLLFNBQVM7Z0JBQ1osTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLEVBQUUsc0JBQXNCLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQTtZQUNsRSxTQUFTLE1BQU0sSUFBSSxTQUFTLENBQUMseUJBQXlCLENBQUMsQ0FBQTtRQUN6RCxDQUFDO0lBQ0gsQ0FBQztDQUNGO0FBN0ZELHNDQTZGQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIFJhbmdlLCBUZXh0RWRpdG9yLCBQb2ludCwgQ29tcG9zaXRlRGlzcG9zYWJsZSwgR3V0dGVyLCBEaXNwbGF5TWFya2VyLFxuICBEaXNwbGF5TWFya2VyTGF5ZXJcbn0gZnJvbSAnYXRvbSdcblxuaW1wb3J0IHtSZXN1bHRJdGVtfSBmcm9tICcuLi9yZXN1bHRzLWRiJ1xuaW1wb3J0IHtNZXNzYWdlT2JqZWN0fSBmcm9tICcuLi91dGlscydcbmltcG9ydCB7UmVzdWx0c0RCfSBmcm9tICcuLi9yZXN1bHRzLWRiJ1xuaW1wb3J0IHtURXZlbnRSYW5nZVR5cGV9IGZyb20gJy4uL2VkaXRvci1jb250cm9sL3Rvb2x0aXAtbWFuYWdlcidcbmltcG9ydCB7VG9vbHRpcFJlZ2lzdHJ5fSBmcm9tICcuLi90b29sdGlwLXJlZ2lzdHJ5J1xuXG5leHBvcnQgY2xhc3MgTWFya2VyTWFuYWdlciB7XG4gIHB1YmxpYyBndXR0ZXI6IEd1dHRlclxuICBwcml2YXRlIG1hcmtlcnM6IERpc3BsYXlNYXJrZXJMYXllclxuICBwcml2YXRlIGRpc3Bvc2FibGVzOiBDb21wb3NpdGVEaXNwb3NhYmxlXG4gIHByaXZhdGUgbWFya2VyUHJvcHM6IFdlYWtNYXA8RGlzcGxheU1hcmtlciwgUmVzdWx0SXRlbT5cbiAgY29uc3RydWN0b3IgKHByaXZhdGUgZWRpdG9yOiBUZXh0RWRpdG9yLCBwcml2YXRlIHJlc3VsdHM6IFJlc3VsdHNEQiwgcHJpdmF0ZSB0b29sdGlwUmVnaXN0cnk6IFRvb2x0aXBSZWdpc3RyeSkge1xuICAgIHRoaXMuZ3V0dGVyID0gdGhpcy5lZGl0b3IuZ3V0dGVyV2l0aE5hbWUoJ2lkZS1oYXNrZWxsLWNoZWNrLXJlc3VsdHMnKVxuXG4gICAgdGhpcy5kaXNwb3NhYmxlcyA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKClcbiAgICB0aGlzLm1hcmtlcnMgPSBlZGl0b3IuYWRkTWFya2VyTGF5ZXIoe1xuICAgICAgbWFpbnRhaW5IaXN0b3J5OiB0cnVlLFxuICAgICAgcGVyc2lzdGVudDogZmFsc2VcbiAgICB9KVxuICAgIHRoaXMubWFya2VyUHJvcHMgPSBuZXcgV2Vha01hcCgpXG4gICAgdGhpcy5kaXNwb3NhYmxlcy5hZGQocmVzdWx0cy5vbkRpZFVwZGF0ZSh0aGlzLnVwZGF0ZVJlc3VsdHMuYmluZCh0aGlzKSkpXG4gICAgdGhpcy5kaXNwb3NhYmxlcy5hZGQodG9vbHRpcFJlZ2lzdHJ5LnJlZ2lzdGVyKCdidWlsdGluOmNoZWNrLXJlc3VsdHMnLCB7XG4gICAgICBwcmlvcml0eTogMjAwLFxuICAgICAgaGFuZGxlcjogdGhpcy50b29sdGlwUHJvdmlkZXIuYmluZCh0aGlzKVxuICAgIH0pKVxuICB9XG5cbiAgcHVibGljIGRpc3Bvc2UgKCkge1xuICAgIHRoaXMubWFya2Vycy5kZXN0cm95KClcbiAgICB0aGlzLmRpc3Bvc2FibGVzLmRpc3Bvc2UoKVxuICB9XG5cbiAgcHJpdmF0ZSB0b29sdGlwUHJvdmlkZXIgKGVkaXRvcjogVGV4dEVkaXRvciwgY3JhbmdlOiBSYW5nZSwgdHlwZTogVEV2ZW50UmFuZ2VUeXBlKSB7XG4gICAgY29uc3QgbXNnID0gdGhpcy5nZXRNZXNzYWdlQXQoY3JhbmdlLnN0YXJ0LCB0eXBlKVxuICAgIGlmIChtc2cubGVuZ3RoID4gMCkge1xuICAgICAgcmV0dXJuIHsgcmFuZ2U6IGNyYW5nZSwgdGV4dDogbXNnIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldE1lc3NhZ2VBdCAocG9zOiBQb2ludCwgdHlwZTogVEV2ZW50UmFuZ2VUeXBlKSB7XG4gICAgY29uc3QgbWFya2VycyA9IHRoaXMuZmluZChwb3MsIHR5cGUpXG4gICAgY29uc3QgcmVzdWx0OiBNZXNzYWdlT2JqZWN0W10gPSBbXVxuICAgIGZvciAoY29uc3QgbWFya2VyIG9mIG1hcmtlcnMpIHtcbiAgICAgIGNvbnN0IHJlcyA9IHRoaXMubWFya2VyUHJvcHMuZ2V0KG1hcmtlcilcbiAgICAgIGlmICghcmVzKSB7IGNvbnRpbnVlIH1cbiAgICAgIHJlc3VsdC5wdXNoKHJlcy5tZXNzYWdlKVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZVJlc3VsdHMgKCkge1xuICAgIHRoaXMubWFya2Vycy5jbGVhcigpXG4gICAgY29uc3QgcGF0aCA9IHRoaXMuZWRpdG9yLmdldFBhdGgoKVxuICAgIGZvciAoY29uc3QgcmVzIG9mIHRoaXMucmVzdWx0cy5maWx0ZXIoKHt1cml9KSA9PiB1cmkgPT09IHBhdGgpKSB7XG4gICAgICB0aGlzLm1hcmtlckZyb21DaGVja1Jlc3VsdChyZXMpXG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBtYXJrZXJGcm9tQ2hlY2tSZXN1bHQgKHJlc0l0ZW06IFJlc3VsdEl0ZW0pIHtcbiAgICBjb25zdCB7cG9zaXRpb259ID0gcmVzSXRlbVxuICAgIGlmICghcG9zaXRpb24pIHsgcmV0dXJuIH1cblxuICAgIGNvbnN0IHJhbmdlID0gbmV3IFJhbmdlKHBvc2l0aW9uLCBQb2ludC5mcm9tT2JqZWN0KFtwb3NpdGlvbi5yb3csIHBvc2l0aW9uLmNvbHVtbiArIDFdKSlcbiAgICBjb25zdCBtYXJrZXIgPSB0aGlzLm1hcmtlcnMubWFya0J1ZmZlclJhbmdlKHJhbmdlLCB7IGludmFsaWRhdGU6ICd0b3VjaCcgfSlcbiAgICB0aGlzLm1hcmtlclByb3BzLnNldChtYXJrZXIsIHJlc0l0ZW0pXG4gICAgY29uc3QgZGlzcCA9IG1hcmtlci5vbkRpZENoYW5nZSgoe2lzVmFsaWR9OiBEaXNwbGF5TWFya2VyKSA9PiB7XG4gICAgICBpZiAoIWlzVmFsaWQpIHtcbiAgICAgICAgdGhpcy5tYXJrZXJQcm9wcy5kZWxldGUobWFya2VyKVxuICAgICAgICByZXNJdGVtLmRlc3Ryb3koKVxuICAgICAgICBtYXJrZXIuZGVzdHJveSgpXG4gICAgICAgIGRpc3AuZGlzcG9zZSgpXG4gICAgICB9XG4gICAgfSlcbiAgICB0aGlzLmRlY29yYXRlTWFya2VyKG1hcmtlciwgcmVzSXRlbSlcbiAgfVxuXG4gIHByaXZhdGUgZGVjb3JhdGVNYXJrZXIgKG06IERpc3BsYXlNYXJrZXIsIHI6IFJlc3VsdEl0ZW0pIHtcbiAgICBpZiAoIXRoaXMuZ3V0dGVyKSB7XG4gICAgICByZXR1cm5cbiAgICB9XG4gICAgY29uc3QgY2xzID0ge2NsYXNzOiBgaWRlLWhhc2tlbGwtJHtyLnNldmVyaXR5fWB9XG4gICAgdGhpcy5ndXR0ZXIuZGVjb3JhdGVNYXJrZXIobSwgeyB0eXBlOiAnbGluZS1udW1iZXInLCAuLi5jbHMgfSlcbiAgICB0aGlzLmVkaXRvci5kZWNvcmF0ZU1hcmtlcihtLCB7IHR5cGU6ICdoaWdobGlnaHQnLCAuLi5jbHMgfSlcbiAgICB0aGlzLmVkaXRvci5kZWNvcmF0ZU1hcmtlcihtLCB7IHR5cGU6ICdsaW5lJywgLi4uY2xzIH0pXG4gIH1cblxuICBwcml2YXRlIGZpbmQgKHBvczogUG9pbnQsIHR5cGU6IFRFdmVudFJhbmdlVHlwZSkge1xuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgY2FzZSAnZ3V0dGVyJzpcbiAgICAgIGNhc2UgJ3NlbGVjdGlvbic6IC8vIFRPRE86IHRoaXMgaXMgbm90IGdvb2RcbiAgICAgICAgcmV0dXJuIHRoaXMubWFya2Vycy5maW5kTWFya2Vycyh7IHN0YXJ0QnVmZmVyUm93OiBwb3Mucm93IH0pXG4gICAgICBjYXNlICdrZXlib2FyZCc6XG4gICAgICAgIHJldHVybiB0aGlzLm1hcmtlcnMuZmluZE1hcmtlcnMoeyBzdGFydEJ1ZmZlclBvc2l0aW9uOiBwb3MgfSlcbiAgICAgIGNhc2UgJ21vdXNlJzpcbiAgICAgIGNhc2UgJ2NvbnRleHQnOlxuICAgICAgICByZXR1cm4gdGhpcy5tYXJrZXJzLmZpbmRNYXJrZXJzKHsgY29udGFpbnNCdWZmZXJQb3NpdGlvbjogcG9zIH0pXG4gICAgICBkZWZhdWx0OiB0aHJvdyBuZXcgVHlwZUVycm9yKCdTd2l0Y2ggYXNzZXJ0aW9uIGZhaWxlZCcpXG4gICAgfVxuICB9XG59XG4iXX0=