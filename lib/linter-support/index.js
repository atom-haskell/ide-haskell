"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const atom_1 = require("atom");
class LinterSupport {
    constructor(linter, resultDb) {
        this.linter = linter;
        this.resultDb = resultDb;
        this.disposables = new atom_1.CompositeDisposable();
        this.disposables.add(resultDb.onDidUpdate(this.update.bind(this)));
    }
    destroy() {
        this.disposables.dispose();
        this.linter.dispose();
    }
    update() {
        this.linter.deleteMessages();
        this.linter.setMessages(Array.from(this.messages()));
    }
    *messages() {
        for (const result of this.resultDb.results()) {
            if (result.uri && result.position) {
                yield {
                    type: result.severity === 'lint' ? 'info' : result.severity,
                    html: result.message.toHtml(true),
                    filePath: result.uri,
                    range: new atom_1.Range(result.position, result.position.translate([0, 1]))
                };
            }
        }
    }
}
exports.LinterSupport = LinterSupport;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvbGludGVyLXN1cHBvcnQvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSwrQkFBK0M7QUFLL0M7SUFFRSxZQUFxQixNQUFzQixFQUFVLFFBQW1CO1FBQW5ELFdBQU0sR0FBTixNQUFNLENBQWdCO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBVztRQUN0RSxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksMEJBQW1CLEVBQUUsQ0FBQTtRQUU1QyxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQTtJQUNwRSxDQUFDO0lBRU0sT0FBTztRQUNaLElBQUksQ0FBQyxXQUFXLENBQUMsT0FBTyxFQUFFLENBQUE7UUFDMUIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsQ0FBQTtJQUN2QixDQUFDO0lBRU0sTUFBTTtRQUNYLElBQUksQ0FBQyxNQUFNLENBQUMsY0FBYyxFQUFFLENBQUE7UUFDNUIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQyxDQUFBO0lBQ3RELENBQUM7SUFFRCxDQUFVLFFBQVE7UUFDaEIsR0FBRyxDQUFDLENBQUMsTUFBTSxNQUFNLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDN0MsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLEdBQUcsSUFBSSxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztnQkFDbEMsTUFBTTtvQkFDSixJQUFJLEVBQUUsTUFBTSxDQUFDLFFBQVEsS0FBSyxNQUFNLEdBQUcsTUFBTSxHQUFHLE1BQU0sQ0FBQyxRQUFRO29CQUMzRCxJQUFJLEVBQUUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDO29CQUNqQyxRQUFRLEVBQUUsTUFBTSxDQUFDLEdBQUc7b0JBQ3BCLEtBQUssRUFBRSxJQUFJLFlBQUssQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7aUJBQ3JFLENBQUE7WUFDSCxDQUFDO1FBQ0gsQ0FBQztJQUNILENBQUM7Q0FDRjtBQTlCRCxzQ0E4QkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NvbXBvc2l0ZURpc3Bvc2FibGUsIFJhbmdlfSBmcm9tICdhdG9tJ1xuaW1wb3J0IHtSZXN1bHRzREJ9IGZyb20gJy4uL3Jlc3VsdHMtZGInXG5pbXBvcnQgKiBhcyBMaW50ZXIgZnJvbSAnLi9saW50ZXInXG5leHBvcnQgKiBmcm9tICcuL2xpbnRlcidcblxuZXhwb3J0IGNsYXNzIExpbnRlclN1cHBvcnQge1xuICBwcml2YXRlIGRpc3Bvc2FibGVzOiBDb21wb3NpdGVEaXNwb3NhYmxlXG4gIGNvbnN0cnVjdG9yIChwcml2YXRlIGxpbnRlcjogTGludGVyLklMaW50ZXIsIHByaXZhdGUgcmVzdWx0RGI6IFJlc3VsdHNEQikge1xuICAgIHRoaXMuZGlzcG9zYWJsZXMgPSBuZXcgQ29tcG9zaXRlRGlzcG9zYWJsZSgpXG5cbiAgICB0aGlzLmRpc3Bvc2FibGVzLmFkZChyZXN1bHREYi5vbkRpZFVwZGF0ZSh0aGlzLnVwZGF0ZS5iaW5kKHRoaXMpKSlcbiAgfVxuXG4gIHB1YmxpYyBkZXN0cm95ICgpIHtcbiAgICB0aGlzLmRpc3Bvc2FibGVzLmRpc3Bvc2UoKVxuICAgIHRoaXMubGludGVyLmRpc3Bvc2UoKVxuICB9XG5cbiAgcHVibGljIHVwZGF0ZSAoKSB7XG4gICAgdGhpcy5saW50ZXIuZGVsZXRlTWVzc2FnZXMoKVxuICAgIHRoaXMubGludGVyLnNldE1lc3NhZ2VzKEFycmF5LmZyb20odGhpcy5tZXNzYWdlcygpKSlcbiAgfVxuXG4gIHByaXZhdGUgKiBtZXNzYWdlcyAoKSB7XG4gICAgZm9yIChjb25zdCByZXN1bHQgb2YgdGhpcy5yZXN1bHREYi5yZXN1bHRzKCkpIHtcbiAgICAgIGlmIChyZXN1bHQudXJpICYmIHJlc3VsdC5wb3NpdGlvbikge1xuICAgICAgICB5aWVsZCB7XG4gICAgICAgICAgdHlwZTogcmVzdWx0LnNldmVyaXR5ID09PSAnbGludCcgPyAnaW5mbycgOiByZXN1bHQuc2V2ZXJpdHksXG4gICAgICAgICAgaHRtbDogcmVzdWx0Lm1lc3NhZ2UudG9IdG1sKHRydWUpLFxuICAgICAgICAgIGZpbGVQYXRoOiByZXN1bHQudXJpLFxuICAgICAgICAgIHJhbmdlOiBuZXcgUmFuZ2UocmVzdWx0LnBvc2l0aW9uLCByZXN1bHQucG9zaXRpb24udHJhbnNsYXRlKFswLCAxXSkpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cbiJdfQ==