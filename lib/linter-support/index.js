"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const atom_1 = require("atom");
class LinterSupport {
    constructor(linter, resultDb) {
        this.linter = linter;
        this.resultDb = resultDb;
        this.disposables = new atom_1.CompositeDisposable();
        this.disposables.add(resultDb.onDidUpdate(this.update.bind(this)));
    }
    destroy() {
        this.disposables.dispose();
        this.linter.dispose();
    }
    update() {
        this.linter.deleteMessages();
        this.linter.setMessages(Array.from(this.messages()));
    }
    *messages() {
        for (const result of this.resultDb.results()) {
            if (result.uri && result.position) {
                yield {
                    type: result.severity === 'lint' ? 'info' : result.severity,
                    html: result.message.toHtml(),
                    filePath: result.uri,
                    range: new atom_1.Range(result.position, result.position.translate([0, 1]))
                };
            }
        }
    }
}
exports.LinterSupport = LinterSupport;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvbGludGVyLXN1cHBvcnQvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSwrQkFBK0M7QUFLL0M7SUFFRSxZQUFxQixNQUFzQixFQUFVLFFBQW1CO1FBQW5ELFdBQU0sR0FBTixNQUFNLENBQWdCO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBVztRQUN0RSxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksMEJBQW1CLEVBQUUsQ0FBQTtRQUU1QyxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQTtJQUNwRSxDQUFDO0lBRU0sT0FBTztRQUNaLElBQUksQ0FBQyxXQUFXLENBQUMsT0FBTyxFQUFFLENBQUE7UUFDMUIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsQ0FBQTtJQUN2QixDQUFDO0lBRU0sTUFBTTtRQUNYLElBQUksQ0FBQyxNQUFNLENBQUMsY0FBYyxFQUFFLENBQUE7UUFDNUIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQyxDQUFBO0lBQ3RELENBQUM7SUFFRCxDQUFVLFFBQVE7UUFDaEIsR0FBRyxDQUFDLENBQUMsTUFBTSxNQUFNLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDN0MsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLEdBQUcsSUFBSSxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztnQkFDbEMsTUFBTTtvQkFDSixJQUFJLEVBQUUsTUFBTSxDQUFDLFFBQVEsS0FBSyxNQUFNLEdBQUcsTUFBTSxHQUFHLE1BQU0sQ0FBQyxRQUFRO29CQUMzRCxJQUFJLEVBQUUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUU7b0JBQzdCLFFBQVEsRUFBRSxNQUFNLENBQUMsR0FBRztvQkFDcEIsS0FBSyxFQUFFLElBQUksWUFBSyxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUUsTUFBTSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztpQkFDckUsQ0FBQTtZQUNILENBQUM7UUFDSCxDQUFDO0lBQ0gsQ0FBQztDQUNGO0FBOUJELHNDQThCQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Q29tcG9zaXRlRGlzcG9zYWJsZSwgUmFuZ2V9IGZyb20gJ2F0b20nXG5pbXBvcnQge1Jlc3VsdHNEQn0gZnJvbSAnLi4vcmVzdWx0cy1kYidcbmltcG9ydCAqIGFzIExpbnRlciBmcm9tICcuL2xpbnRlcidcbmV4cG9ydCAqIGZyb20gJy4vbGludGVyJ1xuXG5leHBvcnQgY2xhc3MgTGludGVyU3VwcG9ydCB7XG4gIHByaXZhdGUgZGlzcG9zYWJsZXM6IENvbXBvc2l0ZURpc3Bvc2FibGVcbiAgY29uc3RydWN0b3IgKHByaXZhdGUgbGludGVyOiBMaW50ZXIuSUxpbnRlciwgcHJpdmF0ZSByZXN1bHREYjogUmVzdWx0c0RCKSB7XG4gICAgdGhpcy5kaXNwb3NhYmxlcyA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKClcblxuICAgIHRoaXMuZGlzcG9zYWJsZXMuYWRkKHJlc3VsdERiLm9uRGlkVXBkYXRlKHRoaXMudXBkYXRlLmJpbmQodGhpcykpKVxuICB9XG5cbiAgcHVibGljIGRlc3Ryb3kgKCkge1xuICAgIHRoaXMuZGlzcG9zYWJsZXMuZGlzcG9zZSgpXG4gICAgdGhpcy5saW50ZXIuZGlzcG9zZSgpXG4gIH1cblxuICBwdWJsaWMgdXBkYXRlICgpIHtcbiAgICB0aGlzLmxpbnRlci5kZWxldGVNZXNzYWdlcygpXG4gICAgdGhpcy5saW50ZXIuc2V0TWVzc2FnZXMoQXJyYXkuZnJvbSh0aGlzLm1lc3NhZ2VzKCkpKVxuICB9XG5cbiAgcHJpdmF0ZSAqIG1lc3NhZ2VzICgpIHtcbiAgICBmb3IgKGNvbnN0IHJlc3VsdCBvZiB0aGlzLnJlc3VsdERiLnJlc3VsdHMoKSkge1xuICAgICAgaWYgKHJlc3VsdC51cmkgJiYgcmVzdWx0LnBvc2l0aW9uKSB7XG4gICAgICAgIHlpZWxkIHtcbiAgICAgICAgICB0eXBlOiByZXN1bHQuc2V2ZXJpdHkgPT09ICdsaW50JyA/ICdpbmZvJyA6IHJlc3VsdC5zZXZlcml0eSxcbiAgICAgICAgICBodG1sOiByZXN1bHQubWVzc2FnZS50b0h0bWwoKSxcbiAgICAgICAgICBmaWxlUGF0aDogcmVzdWx0LnVyaSxcbiAgICAgICAgICByYW5nZTogbmV3IFJhbmdlKHJlc3VsdC5wb3NpdGlvbiwgcmVzdWx0LnBvc2l0aW9uLnRyYW5zbGF0ZShbMCwgMV0pKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59XG4iXX0=