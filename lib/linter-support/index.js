'use babel';
Object.defineProperty(exports, "__esModule", { value: true });
const atom_1 = require("atom");
const utils_1 = require("../utils");
class LinterSupport {
    constructor(linter, resultDb) {
        this.linter = linter;
        this.resultDb = resultDb;
        this.disposables = new atom_1.CompositeDisposable();
        this.disposables.add(resultDb.onDidUpdate(this.update.bind(this)));
    }
    destroy() {
        this.disposables.dispose();
        this.linter.dispose();
        this.linter = null;
        this.resultDb = null;
        this.disposables = null;
    }
    update({ types }) {
        this.linter.deleteMessages();
        this.linter.setMessages(Array.from(this.messages()));
    }
    *messages() {
        for (let result of this.resultDb.resultsWithURI()) {
            yield {
                type: result.severity === 'lint' ? 'info' : result.severity,
                html: utils_1.MessageObject.fromObject(result.message).toHtml(),
                filePath: result.uri,
                range: new atom_1.Range(result.position, result.position.translate([0, 1]))
            };
        }
    }
}
exports.LinterSupport = LinterSupport;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvbGludGVyLXN1cHBvcnQvaW5kZXguanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsV0FBVyxDQUFBOztBQUVYLCtCQUErQztBQUMvQyxvQ0FBc0M7QUFFdEM7SUFDRSxZQUFhLE1BQU0sRUFBRSxRQUFRO1FBQzNCLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFBO1FBQ3BCLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFBO1FBQ3hCLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSwwQkFBbUIsRUFBRSxDQUFBO1FBRTVDLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFBO0lBQ3BFLENBQUM7SUFFRCxPQUFPO1FBQ0wsSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLEVBQUUsQ0FBQTtRQUMxQixJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFBO1FBQ3JCLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFBO1FBQ2xCLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFBO1FBQ3BCLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFBO0lBQ3pCLENBQUM7SUFFRCxNQUFNLENBQUUsRUFBQyxLQUFLLEVBQUM7UUFDYixJQUFJLENBQUMsTUFBTSxDQUFDLGNBQWMsRUFBRSxDQUFBO1FBQzVCLElBQUksQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUMsQ0FBQTtJQUN0RCxDQUFDO0lBRUQsQ0FBRSxRQUFRO1FBQ1IsR0FBRyxDQUFDLENBQUMsSUFBSSxNQUFNLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxjQUFjLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDbEQsTUFBTTtnQkFDSixJQUFJLEVBQUUsTUFBTSxDQUFDLFFBQVEsS0FBSyxNQUFNLEdBQUcsTUFBTSxHQUFHLE1BQU0sQ0FBQyxRQUFRO2dCQUMzRCxJQUFJLEVBQUUscUJBQWEsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLE1BQU0sRUFBRTtnQkFDdkQsUUFBUSxFQUFFLE1BQU0sQ0FBQyxHQUFHO2dCQUNwQixLQUFLLEVBQUUsSUFBSSxZQUFLLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxNQUFNLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQ3JFLENBQUE7UUFDSCxDQUFDO0lBQ0gsQ0FBQztDQUNGO0FBaENELHNDQWdDQyIsInNvdXJjZXNDb250ZW50IjpbIid1c2UgYmFiZWwnXG5cbmltcG9ydCB7Q29tcG9zaXRlRGlzcG9zYWJsZSwgUmFuZ2V9IGZyb20gJ2F0b20nXG5pbXBvcnQge01lc3NhZ2VPYmplY3R9IGZyb20gJy4uL3V0aWxzJ1xuXG5leHBvcnQgY2xhc3MgTGludGVyU3VwcG9ydCB7XG4gIGNvbnN0cnVjdG9yIChsaW50ZXIsIHJlc3VsdERiKSB7XG4gICAgdGhpcy5saW50ZXIgPSBsaW50ZXJcbiAgICB0aGlzLnJlc3VsdERiID0gcmVzdWx0RGJcbiAgICB0aGlzLmRpc3Bvc2FibGVzID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKVxuXG4gICAgdGhpcy5kaXNwb3NhYmxlcy5hZGQocmVzdWx0RGIub25EaWRVcGRhdGUodGhpcy51cGRhdGUuYmluZCh0aGlzKSkpXG4gIH1cblxuICBkZXN0cm95ICgpIHtcbiAgICB0aGlzLmRpc3Bvc2FibGVzLmRpc3Bvc2UoKVxuICAgIHRoaXMubGludGVyLmRpc3Bvc2UoKVxuICAgIHRoaXMubGludGVyID0gbnVsbFxuICAgIHRoaXMucmVzdWx0RGIgPSBudWxsXG4gICAgdGhpcy5kaXNwb3NhYmxlcyA9IG51bGxcbiAgfVxuXG4gIHVwZGF0ZSAoe3R5cGVzfSkge1xuICAgIHRoaXMubGludGVyLmRlbGV0ZU1lc3NhZ2VzKClcbiAgICB0aGlzLmxpbnRlci5zZXRNZXNzYWdlcyhBcnJheS5mcm9tKHRoaXMubWVzc2FnZXMoKSkpXG4gIH1cblxuICAqIG1lc3NhZ2VzICgpIHtcbiAgICBmb3IgKGxldCByZXN1bHQgb2YgdGhpcy5yZXN1bHREYi5yZXN1bHRzV2l0aFVSSSgpKSB7XG4gICAgICB5aWVsZCB7XG4gICAgICAgIHR5cGU6IHJlc3VsdC5zZXZlcml0eSA9PT0gJ2xpbnQnID8gJ2luZm8nIDogcmVzdWx0LnNldmVyaXR5LFxuICAgICAgICBodG1sOiBNZXNzYWdlT2JqZWN0LmZyb21PYmplY3QocmVzdWx0Lm1lc3NhZ2UpLnRvSHRtbCgpLFxuICAgICAgICBmaWxlUGF0aDogcmVzdWx0LnVyaSxcbiAgICAgICAgcmFuZ2U6IG5ldyBSYW5nZShyZXN1bHQucG9zaXRpb24sIHJlc3VsdC5wb3NpdGlvbi50cmFuc2xhdGUoWzAsIDFdKSlcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cbiJdfQ==