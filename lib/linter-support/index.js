"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const atom_1 = require("atom");
class LinterSupport {
    constructor(linter, resultDb) {
        this.linter = linter;
        this.resultDb = resultDb;
        this.disposables = new atom_1.CompositeDisposable();
        this.disposables.add(resultDb.onDidUpdate(this.update.bind(this)));
    }
    destroy() {
        this.disposables.dispose();
        this.linter.dispose();
    }
    update() {
        this.linter.deleteMessages();
        this.linter.setMessages(Array.from(this.messages()));
    }
    *messages() {
        for (const result of this.resultDb.results()) {
            if (result.uri && result.position) {
                yield {
                    type: result.severity === 'lint' ? 'info' : result.severity,
                    html: result.message.toHtml(),
                    filePath: result.uri,
                    range: new atom_1.Range(result.position, result.position.translate([0, 1]))
                };
            }
        }
    }
}
exports.LinterSupport = LinterSupport;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvbGludGVyLXN1cHBvcnQvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSwrQkFBK0M7QUFTL0M7SUFFRSxZQUFxQixNQUFlLEVBQVUsUUFBbUI7UUFBNUMsV0FBTSxHQUFOLE1BQU0sQ0FBUztRQUFVLGFBQVEsR0FBUixRQUFRLENBQVc7UUFDL0QsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLDBCQUFtQixFQUFFLENBQUE7UUFFNUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUE7SUFDcEUsQ0FBQztJQUVNLE9BQU87UUFDWixJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sRUFBRSxDQUFBO1FBQzFCLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUFFLENBQUE7SUFDdkIsQ0FBQztJQUVNLE1BQU07UUFDWCxJQUFJLENBQUMsTUFBTSxDQUFDLGNBQWMsRUFBRSxDQUFBO1FBQzVCLElBQUksQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUMsQ0FBQTtJQUN0RCxDQUFDO0lBRUQsQ0FBVSxRQUFRO1FBQ2hCLEdBQUcsQ0FBQyxDQUFDLE1BQU0sTUFBTSxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQzdDLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxHQUFHLElBQUksTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7Z0JBQ2xDLE1BQU07b0JBQ0osSUFBSSxFQUFFLE1BQU0sQ0FBQyxRQUFRLEtBQUssTUFBTSxHQUFHLE1BQU0sR0FBRyxNQUFNLENBQUMsUUFBUTtvQkFDM0QsSUFBSSxFQUFFLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFO29CQUM3QixRQUFRLEVBQUUsTUFBTSxDQUFDLEdBQUc7b0JBQ3BCLEtBQUssRUFBRSxJQUFJLFlBQUssQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7aUJBQ3JFLENBQUE7WUFDSCxDQUFDO1FBQ0gsQ0FBQztJQUNILENBQUM7Q0FDRjtBQTlCRCxzQ0E4QkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NvbXBvc2l0ZURpc3Bvc2FibGUsIFJhbmdlfSBmcm9tICdhdG9tJ1xuaW1wb3J0IHtSZXN1bHRzREJ9IGZyb20gJy4uL3Jlc3VsdHMtZGInXG5cbmludGVyZmFjZSBJTGludGVyIHtcbiAgZGVsZXRlTWVzc2FnZXMgKCk6IHZvaWRcbiAgc2V0TWVzc2FnZXMgKG1lc3NhZ2VzOiBhbnlbXSk6IHZvaWRcbiAgZGlzcG9zZSAoKTogdm9pZFxufVxuXG5leHBvcnQgY2xhc3MgTGludGVyU3VwcG9ydCB7XG4gIHByaXZhdGUgZGlzcG9zYWJsZXM6IENvbXBvc2l0ZURpc3Bvc2FibGVcbiAgY29uc3RydWN0b3IgKHByaXZhdGUgbGludGVyOiBJTGludGVyLCBwcml2YXRlIHJlc3VsdERiOiBSZXN1bHRzREIpIHtcbiAgICB0aGlzLmRpc3Bvc2FibGVzID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKVxuXG4gICAgdGhpcy5kaXNwb3NhYmxlcy5hZGQocmVzdWx0RGIub25EaWRVcGRhdGUodGhpcy51cGRhdGUuYmluZCh0aGlzKSkpXG4gIH1cblxuICBwdWJsaWMgZGVzdHJveSAoKSB7XG4gICAgdGhpcy5kaXNwb3NhYmxlcy5kaXNwb3NlKClcbiAgICB0aGlzLmxpbnRlci5kaXNwb3NlKClcbiAgfVxuXG4gIHB1YmxpYyB1cGRhdGUgKCkge1xuICAgIHRoaXMubGludGVyLmRlbGV0ZU1lc3NhZ2VzKClcbiAgICB0aGlzLmxpbnRlci5zZXRNZXNzYWdlcyhBcnJheS5mcm9tKHRoaXMubWVzc2FnZXMoKSkpXG4gIH1cblxuICBwcml2YXRlICogbWVzc2FnZXMgKCkge1xuICAgIGZvciAoY29uc3QgcmVzdWx0IG9mIHRoaXMucmVzdWx0RGIucmVzdWx0cygpKSB7XG4gICAgICBpZiAocmVzdWx0LnVyaSAmJiByZXN1bHQucG9zaXRpb24pIHtcbiAgICAgICAgeWllbGQge1xuICAgICAgICAgIHR5cGU6IHJlc3VsdC5zZXZlcml0eSA9PT0gJ2xpbnQnID8gJ2luZm8nIDogcmVzdWx0LnNldmVyaXR5LFxuICAgICAgICAgIGh0bWw6IHJlc3VsdC5tZXNzYWdlLnRvSHRtbCgpLFxuICAgICAgICAgIGZpbGVQYXRoOiByZXN1bHQudXJpLFxuICAgICAgICAgIHJhbmdlOiBuZXcgUmFuZ2UocmVzdWx0LnBvc2l0aW9uLCByZXN1bHQucG9zaXRpb24udHJhbnNsYXRlKFswLCAxXSkpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cbiJdfQ==