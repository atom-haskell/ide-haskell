"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const result_item_1 = require("./result-item");
exports.ResultItem = result_item_1.ResultItem;
const atom_1 = require("atom");
class ResultsDB {
    constructor() {
        this._results = [];
        this.disposables = new atom_1.CompositeDisposable();
        this.emitter = new atom_1.Emitter();
        this.disposables.add(this.emitter);
    }
    destroy() {
        this.disposables.dispose();
    }
    onDidUpdate(callback) {
        return this.emitter.on('did-update', callback);
    }
    setResults(res, severityArr) {
        if (severityArr) {
            const sa = severityArr;
            this._results =
                this._results.filter(({ severity }) => !(sa.includes(severity)))
                    .concat(res.map((i) => new result_item_1.ResultItem(this, i)));
        }
        else {
            this._results = res.map((i) => new result_item_1.ResultItem(this, i));
        }
        if (!severityArr) {
            severityArr = this.calcSeverityArr(res);
        }
        this.emitter.emit('did-update', { res: this, types: severityArr });
    }
    appendResults(res, severityArr) {
        this._results = this._results.concat(res.map((r) => new result_item_1.ResultItem(this, r)));
        if (!severityArr) {
            severityArr = this.calcSeverityArr(res);
        }
        this.emitter.emit('did-update', { res: this, types: severityArr });
    }
    removeResult(resItem) {
        this._results = this._results.filter((res) => res !== resItem);
        resItem.parent = undefined;
    }
    results() {
        return this._results;
    }
    filter(f) {
        return this._results.filter(f);
    }
    isEmpty() {
        return this._results.length === 0;
    }
    calcSeverityArr(res) {
        const severityArr = [];
        for (const { severity } of res) {
            if (!severityArr.includes(severity)) {
                severityArr.push(severity);
            }
        }
        return severityArr;
    }
}
exports.ResultsDB = ResultsDB;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvcmVzdWx0cy1kYi9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLCtDQUEyRTtBQUdoQyw4Q0FBVTtBQUZyRCwrQkFBaUQ7QUFPakQ7SUFJRTtRQUNFLElBQUksQ0FBQyxRQUFRLEdBQUcsRUFBRSxDQUFBO1FBQ2xCLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSwwQkFBbUIsRUFBRSxDQUFBO1FBQzVDLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxjQUFPLEVBQUUsQ0FBQTtRQUM1QixJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUE7SUFDcEMsQ0FBQztJQUVNLE9BQU87UUFDWixJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sRUFBRSxDQUFBO0lBQzVCLENBQUM7SUFFTSxXQUFXLENBQUUsUUFBeUI7UUFDM0MsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLFlBQVksRUFBRSxRQUFRLENBQUMsQ0FBQTtJQUNoRCxDQUFDO0lBRU0sVUFBVSxDQUFFLEdBQWtCLEVBQUUsV0FBeUI7UUFDOUQsRUFBRSxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztZQUNoQixNQUFNLEVBQUUsR0FBRyxXQUFXLENBQUE7WUFDdEIsSUFBSSxDQUFDLFFBQVE7Z0JBQ1gsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFDLFFBQVEsRUFBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7cUJBQzdELE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUksd0JBQVUsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFBO1FBQ3BELENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNOLElBQUksQ0FBQyxRQUFRLEdBQUcsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsS0FBSyxJQUFJLHdCQUFVLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFDekQsQ0FBQztRQUVELEVBQUUsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztZQUNqQixXQUFXLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUN6QyxDQUFDO1FBRUQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLEVBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsV0FBVyxFQUFDLENBQUMsQ0FBQTtJQUNsRSxDQUFDO0lBRU0sYUFBYSxDQUFFLEdBQWtCLEVBQUUsV0FBeUI7UUFDakUsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUksd0JBQVUsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFBO1FBRTdFLEVBQUUsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztZQUNqQixXQUFXLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUN6QyxDQUFDO1FBRUQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLEVBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsV0FBVyxFQUFDLENBQUMsQ0FBQTtJQUNsRSxDQUFDO0lBRU0sWUFBWSxDQUFFLE9BQW1CO1FBQ3RDLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLEtBQUssR0FBRyxLQUFLLE9BQU8sQ0FBQyxDQUFBO1FBQzlELE9BQU8sQ0FBQyxNQUFNLEdBQUcsU0FBUyxDQUFBO0lBQzVCLENBQUM7SUFFTSxPQUFPO1FBQ1osTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUE7SUFDdEIsQ0FBQztJQUVNLE1BQU0sQ0FBRSxDQUFnQztRQUM3QyxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUE7SUFDaEMsQ0FBQztJQUVNLE9BQU87UUFDWixNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFBO0lBQ25DLENBQUM7SUFFTyxlQUFlLENBQUUsR0FBa0I7UUFDekMsTUFBTSxXQUFXLEdBQWdCLEVBQUUsQ0FBQTtRQUNuQyxHQUFHLENBQUMsQ0FBQyxNQUFNLEVBQUMsUUFBUSxFQUFDLElBQUksR0FBRyxDQUFDLENBQUMsQ0FBQztZQUM3QixFQUFFLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUE7WUFBQyxDQUFDO1FBQ3JFLENBQUM7UUFDRCxNQUFNLENBQUMsV0FBVyxDQUFBO0lBQ3BCLENBQUM7Q0FDRjtBQXRFRCw4QkFzRUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1RQb3NpdGlvbiwgVFNldmVyaXR5LCBJUmVzdWx0SXRlbSwgUmVzdWx0SXRlbX0gZnJvbSAnLi9yZXN1bHQtaXRlbSdcbmltcG9ydCB7Q29tcG9zaXRlRGlzcG9zYWJsZSwgRW1pdHRlcn0gZnJvbSAnYXRvbSdcblxuZXhwb3J0IHtUUG9zaXRpb24sIFRTZXZlcml0eSwgSVJlc3VsdEl0ZW0sIFJlc3VsdEl0ZW19XG5cbmV4cG9ydCB0eXBlIFRVcGRhdGVDYWxsYmFja0FyZyA9IHtyZXM6IFJlc3VsdHNEQiwgdHlwZXM6IFRTZXZlcml0eVtdfVxuZXhwb3J0IHR5cGUgVFVwZGF0ZUNhbGxiYWNrID0gKGFyZzogVFVwZGF0ZUNhbGxiYWNrQXJnKSA9PiB2b2lkXG5cbmV4cG9ydCBjbGFzcyBSZXN1bHRzREIge1xuICBwcml2YXRlIF9yZXN1bHRzOiBSZXN1bHRJdGVtW11cbiAgcHJpdmF0ZSBkaXNwb3NhYmxlczogQ29tcG9zaXRlRGlzcG9zYWJsZVxuICBwcml2YXRlIGVtaXR0ZXI6IEVtaXR0ZXJcbiAgY29uc3RydWN0b3IgKCkge1xuICAgIHRoaXMuX3Jlc3VsdHMgPSBbXVxuICAgIHRoaXMuZGlzcG9zYWJsZXMgPSBuZXcgQ29tcG9zaXRlRGlzcG9zYWJsZSgpXG4gICAgdGhpcy5lbWl0dGVyID0gbmV3IEVtaXR0ZXIoKVxuICAgIHRoaXMuZGlzcG9zYWJsZXMuYWRkKHRoaXMuZW1pdHRlcilcbiAgfVxuXG4gIHB1YmxpYyBkZXN0cm95ICgpIHtcbiAgICB0aGlzLmRpc3Bvc2FibGVzLmRpc3Bvc2UoKVxuICB9XG5cbiAgcHVibGljIG9uRGlkVXBkYXRlIChjYWxsYmFjazogVFVwZGF0ZUNhbGxiYWNrKSB7XG4gICAgcmV0dXJuIHRoaXMuZW1pdHRlci5vbignZGlkLXVwZGF0ZScsIGNhbGxiYWNrKVxuICB9XG5cbiAgcHVibGljIHNldFJlc3VsdHMgKHJlczogSVJlc3VsdEl0ZW1bXSwgc2V2ZXJpdHlBcnI/OiBUU2V2ZXJpdHlbXSkge1xuICAgIGlmIChzZXZlcml0eUFycikge1xuICAgICAgY29uc3Qgc2EgPSBzZXZlcml0eUFyclxuICAgICAgdGhpcy5fcmVzdWx0cyA9XG4gICAgICAgIHRoaXMuX3Jlc3VsdHMuZmlsdGVyKCh7c2V2ZXJpdHl9KSA9PiAhKHNhLmluY2x1ZGVzKHNldmVyaXR5KSkpXG4gICAgICAgIC5jb25jYXQocmVzLm1hcCgoaSkgPT4gbmV3IFJlc3VsdEl0ZW0odGhpcywgaSkpKVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9yZXN1bHRzID0gcmVzLm1hcCgoaSkgPT4gbmV3IFJlc3VsdEl0ZW0odGhpcywgaSkpXG4gICAgfVxuXG4gICAgaWYgKCFzZXZlcml0eUFycikge1xuICAgICAgc2V2ZXJpdHlBcnIgPSB0aGlzLmNhbGNTZXZlcml0eUFycihyZXMpXG4gICAgfVxuXG4gICAgdGhpcy5lbWl0dGVyLmVtaXQoJ2RpZC11cGRhdGUnLCB7cmVzOiB0aGlzLCB0eXBlczogc2V2ZXJpdHlBcnJ9KVxuICB9XG5cbiAgcHVibGljIGFwcGVuZFJlc3VsdHMgKHJlczogSVJlc3VsdEl0ZW1bXSwgc2V2ZXJpdHlBcnI/OiBUU2V2ZXJpdHlbXSkge1xuICAgIHRoaXMuX3Jlc3VsdHMgPSB0aGlzLl9yZXN1bHRzLmNvbmNhdChyZXMubWFwKChyKSA9PiBuZXcgUmVzdWx0SXRlbSh0aGlzLCByKSkpXG5cbiAgICBpZiAoIXNldmVyaXR5QXJyKSB7XG4gICAgICBzZXZlcml0eUFyciA9IHRoaXMuY2FsY1NldmVyaXR5QXJyKHJlcylcbiAgICB9XG5cbiAgICB0aGlzLmVtaXR0ZXIuZW1pdCgnZGlkLXVwZGF0ZScsIHtyZXM6IHRoaXMsIHR5cGVzOiBzZXZlcml0eUFycn0pXG4gIH1cblxuICBwdWJsaWMgcmVtb3ZlUmVzdWx0IChyZXNJdGVtOiBSZXN1bHRJdGVtKSB7XG4gICAgdGhpcy5fcmVzdWx0cyA9IHRoaXMuX3Jlc3VsdHMuZmlsdGVyKChyZXMpID0+IHJlcyAhPT0gcmVzSXRlbSlcbiAgICByZXNJdGVtLnBhcmVudCA9IHVuZGVmaW5lZFxuICB9XG5cbiAgcHVibGljIHJlc3VsdHMgKCkge1xuICAgIHJldHVybiB0aGlzLl9yZXN1bHRzXG4gIH1cblxuICBwdWJsaWMgZmlsdGVyIChmOiAoaXRlbTogUmVzdWx0SXRlbSkgPT4gYm9vbGVhbikge1xuICAgIHJldHVybiB0aGlzLl9yZXN1bHRzLmZpbHRlcihmKVxuICB9XG5cbiAgcHVibGljIGlzRW1wdHkgKCkge1xuICAgIHJldHVybiB0aGlzLl9yZXN1bHRzLmxlbmd0aCA9PT0gMFxuICB9XG5cbiAgcHJpdmF0ZSBjYWxjU2V2ZXJpdHlBcnIgKHJlczogSVJlc3VsdEl0ZW1bXSkge1xuICAgIGNvbnN0IHNldmVyaXR5QXJyOiBUU2V2ZXJpdHlbXSA9IFtdXG4gICAgZm9yIChjb25zdCB7c2V2ZXJpdHl9IG9mIHJlcykge1xuICAgICAgaWYgKCFzZXZlcml0eUFyci5pbmNsdWRlcyhzZXZlcml0eSkpIHsgc2V2ZXJpdHlBcnIucHVzaChzZXZlcml0eSkgfVxuICAgIH1cbiAgICByZXR1cm4gc2V2ZXJpdHlBcnJcbiAgfVxufVxuIl19