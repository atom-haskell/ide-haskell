"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
const atom_1 = require("atom");
const utils_1 = require("../utils");
const dummy_element_1 = require("./dummy-element");
function instance(pluginManager, outerDisposables, pluginName) {
    const disposables = new atom_1.CompositeDisposable();
    outerDisposables.add(disposables);
    const messageProvider = pluginManager.resultsDB.registerProvider(pluginName);
    disposables.add(messageProvider);
    let messages = [];
    return {
        setMenu(name, menu) {
            let menuDisp;
            disposables.add(menuDisp = atom.menu.add([{
                    label: utils_1.MAIN_MENU_LABEL,
                    submenu: [{ label: name, submenu: menu }]
                }
            ]));
            return menuDisp;
        },
        setStatus(status) {
            return pluginManager.outputPanel.backendStatus(pluginName, status);
        },
        addMessages(newMessages, types) {
            messages.push(...newMessages);
            messageProvider.setMessages(messages);
        },
        setMessages(newMessages, types) {
            messages = [...newMessages];
            messageProvider.setMessages(messages);
        },
        clearMessages(types) {
            messages = messages.filter(({ severity }) => !types.includes(severity));
            messageProvider.setMessages(messages);
        },
        setMessageTypes(types) {
            return (() => {
                const result = [];
                for (const type of Object.keys(types)) {
                    const opts = types[type];
                    result.push(pluginManager.outputPanel.createTab(type, opts));
                }
                return result;
            })();
        },
        onShouldShowTooltip(callback) {
            const disp = pluginManager.tooltipRegistry.register(pluginName, { priority: 100, handler: callback });
            disposables.add(disp);
            return disp;
        },
        showTooltip({ editor, pos, eventType, detail, tooltip }) {
            if (!eventType) {
                eventType = utils_1.getEventType(detail);
            }
            pluginManager.tooltipRegistry.showTooltip(editor, eventType, { pluginName, tooltip });
        },
        onWillSaveBuffer(callback) {
            let disp;
            disposables.add(disp = pluginManager.onWillSaveBuffer(callback));
            return disp;
        },
        onDidSaveBuffer(callback) {
            let disp;
            disposables.add(disp = pluginManager.onDidSaveBuffer(callback));
            return disp;
        },
        onDidStopChanging(callback) {
            let disp;
            disposables.add(disp = pluginManager.onDidStopChanging(callback));
            return disp;
        },
        addPanelControl(element, opts) {
            if (typeof element === 'string') {
                return pluginManager.outputPanel.addPanelControl({ element, opts });
            }
            else {
                const newOpts = Object.assign({}, opts, { element });
                return pluginManager.outputPanel.addPanelControl({ element: dummy_element_1.DummyElement, opts: newOpts });
            }
        },
        addConfigParam(specs) {
            const disp = new atom_1.CompositeDisposable();
            for (const name of Object.keys(specs)) {
                const spec = specs[name];
                disp.add(pluginManager.configParamManager.add(pluginName, name, spec));
            }
            return disp;
        },
        getConfigParam(otherPluginName, name) {
            return __awaiter(this, void 0, void 0, function* () {
                if (!name) {
                    name = otherPluginName;
                    otherPluginName = pluginName;
                }
                return pluginManager.configParamManager.get(otherPluginName, name);
            });
        },
        setConfigParam(otherPluginName, name, value) {
            return __awaiter(this, void 0, void 0, function* () {
                if (value === undefined) {
                    value = name;
                    name = otherPluginName;
                    otherPluginName = pluginName;
                }
                return pluginManager.configParamManager.set(otherPluginName, name, value);
            });
        },
        withEventRange({ editor, detail, eventType, pos }, callback) {
            let ppos;
            if (pos) {
                ppos = atom_1.Point.fromObject(pos);
            }
            if (!eventType) {
                eventType = utils_1.getEventType(detail);
            }
            const controller = pluginManager.controller(editor);
            if (!controller) {
                return;
            }
            const res = controller.getEventRange(eventType);
            if (!res) {
                return;
            }
            return callback(res);
        }
    };
}
exports.instance = instance;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdXBpLTIvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBLCtCQUFvRTtBQUNwRSxvQ0FBd0Q7QUFTeEQsbURBQTRDO0FBK0I1QyxrQkFBMEIsYUFBNEIsRUFBRSxnQkFBcUMsRUFBRSxVQUFrQjtJQUMvRyxNQUFNLFdBQVcsR0FBRyxJQUFJLDBCQUFtQixFQUFFLENBQUE7SUFDN0MsZ0JBQWdCLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxDQUFBO0lBQ2pDLE1BQU0sZUFBZSxHQUFHLGFBQWEsQ0FBQyxTQUFTLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxDQUFDLENBQUE7SUFDNUUsV0FBVyxDQUFDLEdBQUcsQ0FBQyxlQUFlLENBQUMsQ0FBQTtJQUNoQyxJQUFJLFFBQVEsR0FBa0IsRUFBRSxDQUFBO0lBQ2hDLE1BQU0sQ0FBQztRQVFQLE9BQU8sQ0FBRSxJQUFZLEVBQUUsSUFBaUI7WUFDdEMsSUFBSSxRQUFRLENBQUE7WUFDWixXQUFXLENBQUMsR0FBRyxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO29CQUN4QyxLQUFLLEVBQUUsdUJBQWU7b0JBQ3RCLE9BQU8sRUFBRSxDQUFFLEVBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFDLENBQUU7aUJBQzFDO2FBQ0EsQ0FBQyxDQUFDLENBQUE7WUFDSCxNQUFNLENBQUMsUUFBUSxDQUFBO1FBQ2pCLENBQUM7UUFTRCxTQUFTLENBQUUsTUFBZTtZQUN4QixNQUFNLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxhQUFhLENBQUMsVUFBVSxFQUFFLE1BQU0sQ0FBQyxDQUFBO1FBQ3BFLENBQUM7UUFhRCxXQUFXLENBQUUsV0FBMEIsRUFBRSxLQUFtQjtZQUMxRCxRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUcsV0FBVyxDQUFDLENB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LCBUZXh0RWRpdG9yLCBSYW5nZSB9IGZyb20gJ2F0b20nXG5pbXBvcnQgeyBNQUlOX01FTlVfTEFCRUwsIGdldEV2ZW50VHlwZSB9IGZyb20gJy4uL3V0aWxzJ1xuaW1wb3J0IHtQbHVnaW5NYW5hZ2VyfSBmcm9tICcuLi9wbHVnaW4tbWFuYWdlcidcbmltcG9ydCB7SVN0YXR1cywgSVNldmVyaXR5VGFiRGVmaW5pdGlvbiwgSUNvbnRyb2xPcHRzfSBmcm9tICcuLi9vdXRwdXQtcGFuZWwnXG5pbXBvcnQge0lSZXN1bHRJdGVtLCBUU2V2ZXJpdHl9IGZyb20gJy4uL3Jlc3VsdHMtZGInXG5pbXBvcnQge1RFdmVudFJhbmdlVHlwZX0gZnJvbSAnLi4vZWRpdG9yLWNvbnRyb2wvdG9vbHRpcC1tYW5hZ2VyJ1xuaW1wb3J0IHtUUG9zaXRpb259IGZyb20gJy4uL3Jlc3VsdHMtZGInXG5pbXBvcnQge0lQYXJhbVNwZWN9IGZyb20gJy4uL2NvbmZpZy1wYXJhbXMnXG5pbXBvcnQge1RUZXh0QnVmZmVyQ2FsbGJhY2t9IGZyb20gJy4uL2VkaXRvci1jb250cm9sJ1xuaW1wb3J0IHtUVG9vbHRpcEhhbmRsZXIsIFRUb29sdGlwRnVuY3Rpb259IGZyb20gJy4uL3Rvb2x0aXAtcmVnaXN0cnknXG5pbXBvcnQge0R1bW15RWxlbWVudH0gZnJvbSAnLi9kdW1teS1lbGVtZW50J1xuXG5leHBvcnQgaW50ZXJmYWNlIElTaG93VG9vbHRpcFBhcmFtcyB7XG4gIGVkaXRvcjogVGV4dEVkaXRvclxuICBwb3M6IFRQb3NpdGlvblxuICBldmVudFR5cGU/OiBURXZlbnRSYW5nZVR5cGVcbiAgZGV0YWlsPzogT2JqZWN0XG4gIHRvb2x0aXA6IFRUb29sdGlwRnVuY3Rpb25cbn1cblxuZXhwb3J0IGludGVyZmFjZSBJRXZlbnRSYW5nZVBhcmFtcyB7XG4gIGVkaXRvcjogVGV4dEVkaXRvclxuICBkZXRhaWw/OiBPYmplY3RcbiAgZXZlbnRUeXBlPzogVEV2ZW50UmFuZ2VUeXBlXG4gIHBvczogVFBvc2l0aW9uXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSUF0b21NZW51Q29tbWFuZCB7XG4gIGxhYmVsOiBzdHJpbmdcbiAgY29tbWFuZDogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSUF0b21TdWJtZW51IHtcbiAgbGFiZWw6IHN0cmluZ1xuICBzdWJtZW51OiBUQXRvbU1lbnVbXVxufVxuXG5leHBvcnQgdHlwZSBUQXRvbU1lbnUgPSBJQXRvbU1lbnVDb21tYW5kIHwgSUF0b21TdWJtZW51XG5cbmV4cG9ydCB0eXBlIFRFdmVudFJhbmdlQ2FsbGJhY2s8VD4gPSAocGFyczoge3BvczogUG9pbnQsIGNyYW5nZTogUmFuZ2UsIGV2ZW50VHlwZTogVEV2ZW50UmFuZ2VUeXBlfSkgPT4gVFxuXG5leHBvcnQgZnVuY3Rpb24gaW5zdGFuY2UgKHBsdWdpbk1hbmFnZXI6IFBsdWdpbk1hbmFnZXIsIG91dGVyRGlzcG9zYWJsZXM6IENvbXBvc2l0ZURpc3Bvc2FibGUsIHBsdWdpbk5hbWU6IHN0cmluZykge1xuICBjb25zdCBkaXNwb3NhYmxlcyA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKClcbiAgb3V0ZXJEaXNwb3NhYmxlcy5hZGQoZGlzcG9zYWJsZXMpXG4gIGNvbnN0IG1lc3NhZ2VQcm92aWRlciA9IHBsdWdpbk1hbmFnZXIucmVzdWx0c0RCLnJlZ2lzdGVyUHJvdmlkZXIocGx1Z2luTmFtZSlcbiAgZGlzcG9zYWJsZXMuYWRkKG1lc3NhZ2VQcm92aWRlcilcbiAgbGV0IG1lc3NhZ2VzOiBJUmVzdWx0SXRlbVtdID0gW11cbiAgcmV0dXJuIHtcbiAgLypcbiAgQWRkcyBuZXcgc3VtYmVudSB0byAnSGFza2VsbCBJREUnIG1lbnUgaXRlbVxuICBuYW1lIC0tIHN1Ym1lbnUgbGFiZWwsIHNob3VsZCBiZSBkZXNjcmlwdGl2ZSBvZiBhIHBhY2thZ2VcbiAgbWVudSAtLSBBdG9tIG1lbnUgb2JqZWN0XG5cbiAgUmV0dXJucyBEaXNwb3NhYmxlLlxuICAqL1xuICBzZXRNZW51IChuYW1lOiBzdHJpbmcsIG1lbnU6IFRBdG9tTWVudVtdKSB7XG4gICAgbGV0IG1lbnVEaXNwXG4gICAgZGlzcG9zYWJsZXMuYWRkKG1lbnVEaXNwID0gYXRvbS5tZW51LmFkZChbe1xuICAgICAgbGFiZWw6IE1BSU5fTUVOVV9MQUJFTCxcbiAgICAgIHN1Ym1lbnU6IFsge2xhYmVsOiBuYW1lLCBzdWJtZW51OiBtZW51fSBdXG4gICAgfVxuICAgIF0pKVxuICAgIHJldHVybiBtZW51RGlzcFxuICB9LFxuXG4gIC8qXG4gIFNldHMgYmFja2VuZCBzdGF0dXNcbiAgc3RhdHVzIC0tIG9iamVjdFxuICAgIHN0YXR1czogb25lIG9mICdwcm9ncmVzcycsICdyZWFkeScsICdlcnJvcicsICd3YXJuaW5nJ1xuICAgIHByb2dyZXNzOiBmbG9hdCBiZXR3ZWVuIDAgYW5kIDEsIG9ubHkgcmVsZXZhbnQgd2hlbiBzdGF0dXMgaXMgJ3Byb2dyZXNzJ1xuICAgICAgICAgICAgICBpZiAwIG9yIHVuZGVmaW5lZCwgcHJvZ3Jlc3MgYmFyIGlzIG5vdCBzaG93blxuICAqL1xuICBzZXRTdGF0dXMgKHN0YXR1czogSVN0YXR1cykge1xuICAgIHJldHVybiBwbHVnaW5NYW5hZ2VyLm91dHB1dFBhbmVsLmJhY2tlbmRTdGF0dXMocGx1Z2luTmFtZSwgc3RhdHVzKVxuICB9LFxuXG4gIC8qXG4gIEFkZCBtZXNzYWdlcyB0byBpZGUtaGFza2VsbCBvdXRwdXRcbiAgbWVzc2FnZXM6IEFycmF5IG9mIE9iamVjdFxuICAgIHVyaTogU3RyaW5nLCBGaWxlIFVSSSBtZXNzYWdlIHJlbGF0ZXMgdG9cbiAgICBwb3NpdGlvbjogUG9pbnQsIG9yIFBvaW50LWxpa2UgT2JqZWN0LCBwb3NpdGlvbiB0byB3aGljaCBtZXNzYWdlIHJlbGF0ZXNcbiAgICBtZXNzYWdlOiBTdHJpbmcgb3Igezx0ZXh0IHwgaHRtbD4sIGhpZ2hsaWdodGVyP30sIG1lc3NhZ2VcbiAgICBzZXZlcml0eTogU3RyaW5nLCBvbmUgb2YgJ2Vycm9yJywgJ3dhcm5pbmcnLCAnbGludCcsICdidWlsZCcsXG4gICAgICAgICAgICAgIG9yIHVzZXItZGVmaW5lZCwgc2VlIGBzZXRNZXNzYWdlVHlwZXNgXG4gIHR5cGVzOiBBcnJheSBvZiBTdHJpbmcsIGNvbnRhaW5pbmcgcG9zc2libGUgbWVzc2FnZSBgc2V2ZXJpdHlgLiBJZiB1bmRlZmluZWQsXG4gICAgICAgICB3aWxsIGJlIHRha2VuIGZyb20gYG1lc3NhZ2VzYFxuICAqL1xuICBhZGRNZXNzYWdlcyAobmV3TWVzc2FnZXM6IElSZXN1bHRJdGVtW10sIHR5cGVzPzogVFNldmVyaXR5W10pIHtcbiAgICBtZXNzYWdlcy5wdXNoKC4uLm5ld01lc3NhZ2VzKVxuICAgIG1lc3NhZ2VQcm92aWRlci5zZXRNZXNzYWdlcyhtZXNzYWdlcylcbiAgfSxcblxuICAvKlxuICBTZXQgbWVzc2FnZXMgaW4gaWRlLWhhc2tlbGwgb3V0cHV0LiBDbGVhcnMgYWxsIGV4aXN0aW5nIG1lc3NhZ2VzIHdpdGhcbiAgYHNldmVyaXR5YCBpbiBgdHlwZXNgXG4gIG1lc3NhZ2VzOiBBcnJheSBvZiBPYmplY3RcbiAgICB1cmk6IFN0cmluZywgRmlsZSBVUkkgbWVzc2FnZSByZWxhdGVzIHRvXG4gICAgcG9zaXRpb246IFBvaW50LCBvciBQb2ludC1saWtlIE9iamVjdCwgcG9zaXRpb24gdG8gd2hpY2ggbWVzc2FnZSByZWxhdGVzXG4gICAgbWVzc2FnZTogU3RyaW5nLCBtZXNzYWdlXG4gICAgc2V2ZXJpdHk6IFN0cmluZywgb25lIG9mICdlcnJvcicsICd3YXJuaW5nJywgJ2xpbnQnLCAnYnVpbGQnLFxuICAgICAgICAgICAgICBvciB1c2VyLWRlZmluZWQsIHNlZSBgc2V0TWVzc2FnZVR5cGVzYFxuICB0eXBlczogQXJyYXkgb2YgU3RyaW5nLCBjb250YWluaW5nIHBvc3NpYmxlIG1lc3NhZ2UgYHNldmVyaXR5YC4gSWYgdW5kZWZpbmVkLFxuICAgICAgICAgd2lsbCBiZSB0YWtlbiBmcm9tIGBtZXNzYWdlc2BcbiAgKi9cbiAgc2V0TWVzc2FnZXMgKG5ld01lc3NhZ2VzOiBJUmVzdWx0SXRlbVtdLCB0eXBlczogVFNldmVyaXR5W10pIHtcbiAgICBtZXNzYWdlcyA9IFsuLi5uZXdNZXNzYWdlc11cbiAgICBtZXNzYWdlUHJvdmlkZXIuc2V0TWVzc2FnZXMobWVzc2FnZXMpXG4gIH0sXG5cbiAgLypcbiAgQ2xlYXIgYWxsIGV4aXN0aW5nIG1lc3NhZ2VzIHdpdGggYHNldmVyaXR5YCBpbiBgdHlwZXNgXG4gIFRoaXMgaXMgc2hvcnRoYW5kIGZyb20gYHNldE1lc3NhZ2VzKFtdLHR5cGVzKWBcbiAgKi9cbiAgY2xlYXJNZXNzYWdlcyAodHlwZXM6IFRTZXZlcml0eVtdKSB7XG4gICAgbWVzc2FnZXMgPSBtZXNzYWdlcy5maWx0ZXIoKHtzZXZlcml0eX0pID0+ICF0eXBlcy5pbmNsdWRlcyhzZXZlcml0eSkpXG4gICAgbWVzc2FnZVByb3ZpZGVyLnNldE1lc3NhZ2VzKG1lc3NhZ2VzKVxuICB9LFxuXG4gIC8qXG4gIFNldCBwb3NzaWJsZSBtZXNzYWdlIGBzZXZlcml0eWAgdGhhdCB5b3VyIHBhY2thZ2Ugd2lsbCB1c2UuXG4gIHR5cGVzOiBPYmplY3Qgd2l0aCBrZXlzIHJlcHJlc2VudGluZyBwb3NzaWJsZSBtZXNzYWdlIGBzZXZlcml0eWAgKGkuZS4gdGFiIG5hbWUpXG4gICAgICAgICBhbmQgdmFsdWVzIGJlaW5nIE9iamVjdHMgd2l0aCBrZXlzXG4gICAgdXJpRmlsdGVyOiBCb29sLCBzaG91bGQgdXJpIGZpbHRlciBhcHBseSB0byB0YWI/XG4gICAgYXV0b1Njcm9sbDogQm9vbCwgc2hvdWxkIHRhYiBhdXRvLXNjcm9sbD9cblxuICBUaGlzIGFsbG93cyB0byBkZWZpbmUgY3VzdG9tIG91dHB1dCBwYW5lbCB0YWJzLlxuICAqL1xuICBzZXRNZXNzYWdlVHlwZXMgKHR5cGVzOiB7IFtzZXZlcml0eTogc3RyaW5nXTogSVNldmVyaXR5VGFiRGVmaW5pdGlvbn0pIHtcbiAgICByZXR1cm4gKCgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IFtdXG4gICAgICBmb3IgKGNvbnN0IHR5cGUgb2YgT2JqZWN0LmtleXModHlwZXMpKSB7XG4gICAgICAgIGNvbnN0IG9wdHMgPSB0eXBlc1t0eXBlXVxuICAgICAgICByZXN1bHQucHVzaChwbHVnaW5NYW5hZ2VyLm91dHB1dFBhbmVsLmNyZWF0ZVRhYih0eXBlLCBvcHRzKSlcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHRcbiAgICB9KSgpXG4gIH0sXG5cbiAgLypcbiAgRWRpdG9yIGV2ZW50IHN1YnNjcmlwdGlvbi4gRmlyZXMgd2hlbiBtb3VzZSBjdXJzb3Igc3RvcHBlZCBvdmVyIGEgc3ltYm9sIGluXG4gIGVkaXRvci5cblxuICBjYWxsYmFjazogY2FsbGJhY2soZWRpdG9yLCBjcmFuZ2UsIHR5cGUpXG4gICAgZWRpdG9yOiBUZXh0RWRpdG9yLCBlZGl0b3IgdGhhdCBnZW5lcmF0ZWQgZXZlbnRcbiAgICBjcmFuZ2U6IFJhbmdlLCBjdXJzb3IgcmFuZ2UgdGhhdCBnZW5lcmF0ZWQgZXZlbnQuXG4gICAgdHlwZTogT25lIG9mICdtb3VzZScsICdzZWxlY3Rpb24nIC0tIHR5cGUgb2YgZXZlbnQgdGhhdCB0cmlnZ2VyZWQgdGhpc1xuXG4gICAgUmV0dXJucyB7cmFuZ2UsIHRleHR9IG9yIFByb21pc2UuXG4gICAgICByYW5nZTogUmFuZ2UsIHRvb2x0aXAgaGlnaGxpZ2h0aW5nIHJhbmdlXG4gICAgICB0ZXh0OiB0b29sdGlwIHRleHQuIFN0cmluZyBvciB7dGV4dCwgaGlnaGxpZ2h0ZXJ9IG9yIHtodG1sfVxuICAgICAgICB0ZXh0OiB0b29sdGlwIHRleHRcbiAgICAgICAgaGlnaGxpZ2h0ZXI6IGdyYW1tYXIgc2NvcGUgdGhhdCB3aWxsIGJlIHVzZWQgdG8gaGlnaGxpZ2h0IHRvb2x0aXAgdGV4dFxuICAgICAgICBodG1sOiBodG1sIHRvIGJlIGRpc3BsYXllZCBpbiB0b29sdGlwXG5cbiAgcmV0dXJucyBEaXNwb3NhYmxlXG4gICovXG4gIG9uU2hvdWxkU2hvd1Rvb2x0aXAgKGNhbGxiYWNrOiBUVG9vbHRpcEhhbmRsZXIpIHtcbiAgICBjb25zdCBkaXNwID0gcGx1Z2luTWFuYWdlci50b29sdGlwUmVnaXN0cnkucmVnaXN0ZXIoXG4gICAgICBwbHVnaW5OYW1lLCB7cHJpb3JpdHk6IDEwMCwgaGFuZGxlcjogY2FsbGJhY2t9XG4gICAgKVxuICAgIGRpc3Bvc2FibGVzLmFkZChkaXNwKVxuICAgIHJldHVybiBkaXNwXG4gIH0sXG5cbiAgLypcbiAgU2hvdyB0b29sdGlwIGluIGVkaXRvci5cblxuICBlZGl0b3I6IGVkaXRvciB0aGF0IHdpbGwgc2hvdyB0b29sdGlwXG4gIHBvczogdG9vbHRpcCBwb3NpdGlvblxuICBldmVudFR5cGU6IG9uZSBvZiAnY29udGV4dCcsICdrZXlib2FyZCcgYW5kICdtb3VzZSdcbiAgZGV0YWlsOiBmb3IgYXV0b21hdGljIHNlbGVjdGlvbiBiZXR3ZWVuICdjb250ZXh0JyBhbmQgJ2tleWJvYXJkJy5cbiAgICAgICAgICBJZ25vcmVkIGlmICdldmVudFR5cGUnIGlzIHNldC5cbiAgdG9vbHRpcDogZnVuY3Rpb24oY3JhbmdlKVxuICAgIGNyYW5nZTogUmFuZ2UsIGN1cnJlbnRseSBzZWxlY3RlZCByYW5nZSBpbiBlZGl0b3IgKHBvc3NpYmx5IGVtcHR5KVxuXG4gICAgUmV0dXJucyB7cmFuZ2UsIHRleHR9IG9yIFByb21pc2VcbiAgICAgIHJhbmdlOiBSYW5nZSwgdG9vbHRpcCBoaWdobGlnaHRpbmcgcmFuZ2VcbiAgICAgIHBlcnNpc3RPbkN1cnNvck1vdmU6IEJvb2xlYW4sIG9wdGlvbmFsLCBkZWZhdWx0IGZhbHNlLCBwZXJzaXN0IG9uIGN1cnNvciBtb3ZlIHJlZ2FyZGxlc3Mgb2Ygc2V0dGluZ3NcbiAgICAgIHRleHQ6IHRvb2x0aXAgdGV4dC4gU3RyaW5nIG9yIHt0ZXh0LCBoaWdobGlnaHRlcn0gb3Ige2h0bWx9XG4gICAgICAgIHRleHQ6IHRvb2x0aXAgdGV4dFxuICAgICAgICBoaWdobGlnaHRlcjogZ3JhbW1hciBzY29wZSB0aGF0IHdpbGwgYmUgdXNlZCB0byBoaWdobGlnaHQgdG9vbHRpcCB0ZXh0XG4gICAgICAgIGh0bWw6IGh0bWwgdG8gYmUgZGlzcGxheWVkIGluIHRvb2x0aXBcbiAgKi9cbiAgc2hvd1Rvb2x0aXAgKHtlZGl0b3IsIHBvcywgZXZlbnRUeXBlLCBkZXRhaWwsIHRvb2x0aXB9OiBJU2hvd1Rvb2x0aXBQYXJhbXMpIHtcbiAgICBpZiAoIWV2ZW50VHlwZSkge1xuICAgICAgZXZlbnRUeXBlID0gZ2V0RXZlbnRUeXBlKGRldGFpbClcbiAgICB9XG4gICAgcGx1Z2luTWFuYWdlci50b29sdGlwUmVnaXN0cnkuc2hvd1Rvb2x0aXAoXG4gICAgICBlZGl0b3IsIGV2ZW50VHlwZSwge3BsdWdpbk5hbWUsIHRvb2x0aXB9XG4gICAgKVxuICB9LFxuXG4gIC8qXG4gIENvbnZlbmllbmNlIGZ1bmN0aW9uLiBXaWxsIGZpcmUgYmVmb3JlIEhhc2tlbGwgYnVmZmVyIGlzIHNhdmVkLlxuXG4gIGNhbGxiYWNrOiBjYWxsYmFjayhidWZmZXIpXG4gICAgYnVmZmVyOiBUZXh0QnVmZmVyLCBidWZmZXIgdGhhdCBnZW5lcmF0ZWQgZXZlbnRcblxuICBSZXR1cm5zIERpc3Bvc2FibGVcbiAgKi9cbiAgb25XaWxsU2F2ZUJ1ZmZlciAoY2FsbGJhY2s6IFRUZXh0QnVmZmVyQ2FsbGJhY2spIHtcbiAgICBsZXQgZGlzcFxuICAgIGRpc3Bvc2FibGVzLmFkZChkaXNwID0gcGx1Z2luTWFuYWdlci5vbldpbGxTYXZlQnVmZmVyKGNhbGxiYWNrKSlcbiAgICByZXR1cm4gZGlzcFxuICB9LFxuXG4gIC8qXG4gIENvbnZlbmllbmNlIGZ1bmN0aW9uLiBXaWxsIGZpcmUgYWZ0ZXIgSGFza2VsbCBidWZmZXIgaXMgc2F2ZWQuXG5cbiAgY2FsbGJhY2s6IGNhbGxiYWNrKGJ1ZmZlcilcbiAgICBidWZmZXI6IFRleHRCdWZmZXIsIGJ1ZmZlciB0aGF0IGdlbmVyYXRlZCBldmVudFxuXG4gIFJldHVybnMgRGlzcG9zYWJsZVxuICAqL1xuICBvbkRpZFNhdmVCdWZmZXIgKGNhbGxiYWNrOiBUVGV4dEJ1ZmZlckNhbGxiYWNrKSB7XG4gICAgbGV0IGRpc3BcbiAgICBkaXNwb3NhYmxlcy5hZGQoZGlzcCA9IHBsdWdpbk1hbmFnZXIub25EaWRTYXZlQnVmZmVyKGNhbGxiYWNrKSlcbiAgICByZXR1cm4gZGlzcFxuICB9LFxuXG4gIG9uRGlkU3RvcENoYW5naW5nIChjYWxsYmFjazogVFRleHRCdWZmZXJDYWxsYmFjaykge1xuICAgIGxldCBkaXNwXG4gICAgZGlzcG9zYWJsZXMuYWRkKGRpc3AgPSBwbHVnaW5NYW5hZ2VyLm9uRGlkU3RvcENoYW5naW5nKGNhbGxiYWNrKSlcbiAgICByZXR1cm4gZGlzcFxuICB9LFxuXG4gIC8qXG4gIEFkZCBhIG5ldyBjb250cm9sIHRvIG91cHR1dCBwYW5lbCBoZWFkaW5nLlxuXG4gIGVsZW1lbnQ6IEhUTUxFbGVtZW50IG9mIGNvbnRyb2wsIG9yIFN0cmluZyB3aXRoIHRhZyBuYW1lXG4gIG9wdHM6IHZhcmlvdXMgb3B0aW9uc1xuICAgIGlkOiBTdHJpbmcsIGlkXG4gICAgZXZlbnRzOiBPYmplY3QsIGV2ZW50IGNhbGxiYWNrcywga2V5IGlzIGV2ZW50IG5hbWUsIGUuZy4gXCJjbGlja1wiLFxuICAgICAgICAgICAgdmFsdWUgaXMgY2FsbGJhY2tcbiAgICBjbGFzc2VzOiBBcnJheSBvZiBTdHJpbmcsIGNsYXNzZXNcbiAgICBzdHlsZTogT2JqZWN0LCBjc3Mgc3R5bGUsIGtleXMgYXJlIHN0eWxlIGF0dHJpYnV0ZXMsIHZhbHVlcyBhcmUgdmFsdWVzXG4gICAgYXR0cnM6IE9iamVjdCwgb3RoZXIgYXR0cmlidXRlcywga2V5cyBhcmUgYXR0cmlidXRlIG5hbWVzLCB2YWx1ZXMgYXJlIHZhbHVlc1xuICAgIGJlZm9yZTogU3RyaW5nLCBDU1Mgc2VsZWN0b3Igb2YgZWxlbWVudCwgdGhhdCB0aGlzIG9uZSBzaG91bGQgYmUgaW5zZXJ0ZWRcbiAgICAgICAgICAgIGJlZm9yZSwgZS5nLiAnI3Byb2dyZXNzQmFyJ1xuXG4gIFJldHVybnMgRGlzcG9zYWJsZS5cbiAgKi9cbiAgYWRkUGFuZWxDb250cm9sIChlbGVtZW50OiBzdHJpbmcgfCBIVE1MRWxlbWVudCwgb3B0czogSUNvbnRyb2xPcHRzKSB7XG4gICAgaWYgKHR5cGVvZiBlbGVtZW50ID09PSAnc3RyaW5nJykge1xuICAgICAgcmV0dXJuIHBsdWdpbk1hbmFnZXIub3V0cHV0UGFuZWwuYWRkUGFuZWxDb250cm9sKHtlbGVtZW50LCBvcHRzfSlcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgbmV3T3B0czogSUNvbnRyb2xPcHRzICYge2VsZW1lbnQ6IEhUTUxFbGVtZW50fSA9IHsuLi5vcHRzLCBlbGVtZW50fVxuICAgICAgcmV0dXJuIHBsdWdpbk1hbmFnZXIub3V0cHV0UGFuZWwuYWRkUGFuZWxDb250cm9sKHtlbGVtZW50OiBEdW1teUVsZW1lbnQsIG9wdHM6IG5ld09wdHN9KVxuICAgIH1cbiAgfSxcblxuICAvKlxuICBhZGRDb25maWdQYXJhbVxuICAgIHBhcmFtX25hbWU6XG4gICAgICBvbkNoYW5nZWQ6IGNhbGxiYWNrIHZvaWQodmFsdWUpXG4gICAgICBpdGVtczogQXJyYXkgb3IgY2FsbGJhY2sgQXJyYXkodm9pZClcbiAgICAgIGl0ZW1UZW1wbGF0ZTogY2FsbGJhY2ssIFN0cmluZyhpdGVtKSwgaHRtbCB0ZW1wbGF0ZVxuICAgICAgaXRlbUZpbHRlcktleTogU3RyaW5nLCBpdGVtIGZpbHRlciBrZXlcbiAgICAgIGRlc2NyaXB0aW9uOiBTdHJpbmcgW29wdGlvbmFsXVxuICAgICAgZGlzcGxheU5hbWU6IFN0cmluZyBbb3B0aW9uYWwsIGNhcGl0YWxpemVkIHBhcmFtX25hbWUgZGVmYXVsdF1cbiAgICAgIGRpc3BsYXlUZW1wbGF0ZTogY2FsbGJhY2ssIFN0cmluZyhpdGVtKSwgc3RyaW5nIHRlbXBsYXRlXG4gICAgICBkZWZhdWx0OiBpdGVtLCBkZWZhdWx0IHZhbHVlXG5cbiAgUmV0dXJuc1xuICAgIGRpc3A6IERpc3Bvc2FibGVcbiAgICBjaGFuZ2U6IG9iamVjdCBvZiBjaGFuZ2UgZnVuY3Rpb25zLCBrZXlzIGJlaW5nIHBhcmFtX25hbWVcbiAgKi9cbiAgYWRkQ29uZmlnUGFyYW0gKHNwZWNzOiB7IFtwYXJhbU5hbWU6IHN0cmluZ106IElQYXJhbVNwZWM8T2JqZWN0PiB9KSB7XG4gICAgY29uc3QgZGlzcCA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKClcbiAgICBmb3IgKGNvbnN0IG5hbWUgb2YgT2JqZWN0LmtleXMoc3BlY3MpKSB7XG4gICAgICBjb25zdCBzcGVjID0gc3BlY3NbbmFtZV1cbiAgICAgIGRpc3AuYWRkKFxuICAgICAgICBwbHVnaW5NYW5hZ2VyLmNvbmZpZ1BhcmFtTWFuYWdlci5hZGQocGx1Z2luTmFtZSwgbmFtZSwgc3BlYylcbiAgICAgIClcbiAgICB9XG4gICAgcmV0dXJuIGRpc3BcbiAgfSxcblxuICAvKlxuICBnZXRDb25maWdQYXJhbShwYXJhbU5hbWUpIG9yIGdldENvbmZpZ1BhcmFtKHBsdWdpbk5hbWUsIHBhcmFtTmFtZSlcblxuICByZXR1cm5zIGEgUHJvbWlzZSB0aGF0IHJlc29sdmVzIHRvIHBhcmFtZXRlclxuICB2YWx1ZS5cblxuICBQcm9taXNlIGNhbiBiZSByZWplY3RlZCB3aXRoIGVpdGhlciBlcnJvciwgb3IgJ3VuZGVmaW5lZCcuIExhdHRlclxuICBpbiBjYXNlIHVzZXIgY2FuY2VscyBwYXJhbSBzZWxlY3Rpb24gZGlhbG9nLlxuICAqL1xuICBhc3luYyBnZXRDb25maWdQYXJhbSAob3RoZXJQbHVnaW5OYW1lOiBzdHJpbmcsIG5hbWU6IHN0cmluZykge1xuICAgIGlmICghbmFtZSkge1xuICAgICAgbmFtZSA9IG90aGVyUGx1Z2luTmFtZVxuICAgICAgb3RoZXJQbHVnaW5OYW1lID0gcGx1Z2luTmFtZVxuICAgIH1cbiAgICByZXR1cm4gcGx1Z2luTWFuYWdlci5jb25maWdQYXJhbU1hbmFnZXIuZ2V0KG90aGVyUGx1Z2luTmFtZSwgbmFtZSlcbiAgfSxcblxuICAvKlxuICBzZXRDb25maWdQYXJhbShwYXJhbU5hbWUsIHZhbHVlKSBvciBzZXRDb25maWdQYXJhbShwbHVnaW5OYW1lLCBwYXJhbU5hbWUsIHZhbHVlKVxuXG4gIHZhbHVlIGlzIG9wdGlvbmFsLiBJZiBvbWl0dGVkLCBhIHNlbGVjdGlvbiBkaWFsb2cgd2lsbCBiZSBwcmVzZW50ZWQgdG8gdXNlci5cblxuICByZXR1cm5zIGEgUHJvbWlzZSB0aGF0IHJlc29sdmVzIHRvIHBhcmFtZXRlciB2YWx1ZS5cblxuICBQcm9taXNlIGNhbiBiZSByZWplY3RlZCB3aXRoIGVpdGhlciBlcnJvciwgb3IgJ3VuZGVmaW5lZCcuIExhdHRlclxuICBpbiBjYXNlIHVzZXIgY2FuY2VscyBwYXJhbSBzZWxlY3Rpb24gZGlhbG9nLlxuICAqL1xuICBhc3luYyBzZXRDb25maWdQYXJhbSAob3RoZXJQbHVnaW5OYW1lOiBzdHJpbmcsIG5hbWU6IHN0cmluZywgdmFsdWU/OiBPYmplY3QpIHtcbiAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdmFsdWUgPSBuYW1lXG4gICAgICBuYW1lID0gb3RoZXJQbHVnaW5OYW1lXG4gICAgICBvdGhlclBsdWdpbk5hbWUgPSBwbHVnaW5OYW1lXG4gICAgfVxuICAgIHJldHVybiBwbHVnaW5NYW5hZ2VyLmNvbmZpZ1BhcmFtTWFuYWdlci5zZXQob3RoZXJQbHVnaW5OYW1lLCBuYW1lLCB2YWx1ZSlcbiAgfSxcblxuICAvKlxuICBVdGlsaXR5IGZ1bmN0aW9uIHRvIGV4dHJhY3QgZXZlbnQgcmFuZ2UvdHlwZSBmb3IgYSBnaXZlbiBldmVudFxuXG4gIGVkaXRvcjogVGV4dEVkaXRvciwgZWRpdG9yIHRoYXQgZ2VuZXJhdGVkIGV2ZW50XG4gIGRldGFpbDogZXZlbnQgZGV0YWlsLCBpZ25vcmVkIGlmIGV2ZW50VHlwZSBpcyBzZXRcbiAgZXZlbnRUeXBlOiBTdHJpbmcsIGV2ZW50IHR5cGUsIG9uZSBvZiAna2V5Ym9hcmQnLCAnY29udGV4dCcsICdtb3VzZSdcbiAgcG9zOiBQb2ludCwgb3IgUG9pbnQtbGlrZSBPYmplY3QsIGV2ZW50IHBvc2l0aW9uLCBjYW4gYmUgdW5kZWZpbmVkXG4gIGNvbnRyb2xsZXI6IGxlYXZlIHVuZGVmaW5lZCwgdGhpcyBpcyBpbnRlcm5hbCBmaWVsZFxuXG4gIGNhbGxiYWNrOiBjYWxsYmFjayh7cG9zLCBjcmFuZ2UsIGV2ZW50VHlwZX0pXG4gICAgcG9zOiBQb2ludCwgZXZlbnQgcG9zaXRpb25cbiAgICBjcmFuZ2U6IFJhbmdlLCBldmVudCByYW5nZVxuICAgIGV2ZW50VHlwZTogU3RyaW5nLCBldmVudCB0eXBlLCBvbmUgb2YgJ2tleWJvYXJkJywgJ2NvbnRleHQnLCAnbW91c2UnXG4gICovXG4gIHdpdGhFdmVudFJhbmdlPFQ+ICh7ZWRpdG9yLCBkZXRhaWwsIGV2ZW50VHlwZSwgcG9zfTogSUV2ZW50UmFuZ2VQYXJhbXMsIGNhbGxiYWNrOiBURXZlbnRSYW5nZUNhbGxiYWNrPFQ+KSB7XG4gICAgbGV0IHBwb3M6IFBvaW50IHwgdW5kZWZpbmVkXG4gICAgaWYgKHBvcykgeyBwcG9zID0gUG9pbnQuZnJvbU9iamVjdChwb3MpIH1cbiAgICBpZiAoIWV2ZW50VHlwZSkgeyBldmVudFR5cGUgPSBnZXRFdmVudFR5cGUoZGV0YWlsKSB9XG4gICAgY29uc3QgY29udHJvbGxlciA9IHBsdWdpbk1hbmFnZXIuY29udHJvbGxlcihlZGl0b3IpXG4gICAgaWYgKCFjb250cm9sbGVyKSB7IHJldHVybiB9XG4gICAgY29uc3QgcmVzID0gY29udHJvbGxlci5nZXRFdmVudFJhbmdlKGV2ZW50VHlwZSlcbiAgICBpZiAoIXJlcykgeyByZXR1cm4gfVxuICAgIHJldHVybiBjYWxsYmFjayhyZXMpXG4gIH1cbiAgfVxufVxuIl19